import{c as Vt,r as Ut,o as Ke,a as ln,p as cn,j as e,A as dt,b as h,d as gt,u as dn,e as Se,D as et,f as at,g as tt,h as He,i as Pe,T as o,E as Fe,k as Oe,B as u,S as We,l as rt,m as ne,P as Te,F as Ve,I as nt,n as Je,M as le,q as Xe,s as mt,t as pn,v as hn,H as mn,w as fe,x as $e,C as un,y as gn,z as Ct,G as Ze,J as re,K as xn,L as fn,N as Gt,O as bn,Q as _e,R as lt,U as qt,V as Tt,W as Ne,X as It,Y as jn,Z as vn,_ as Ae,$ as ze,a0 as Ie,a1 as yn,a2 as wn,a3 as Cn,a4 as Tn,a5 as $n,a6 as Sn,a7 as kn,a8 as En,a9 as In,aa as Rn,ab as Mn,ac as Ye,ad as Jt,ae as An,af as Fn,ag as xt,ah as Rt,ai as Dn,aj as Yt,ak as Ln,al as Bn,am as Hn,an as Pn,ao as st,ap as yt,aq as Mt,ar as pt,as as On,at as Nn,au as Wn,av as zn,aw as _n,ax as ot,ay as Vn,az as ut,aA as Xt,aB as Un,aC as Zt,aD as Gn,aE as qn,aF as Qt,aG as At,aH as Jn,aI as Yn,aJ as ft,aK as Kt,aL as Xn,aM as Zn,aN as Ft,aO as Qn,aP as Kn,aQ as es,aR as ts,aS as ns,aT as ss,aU as bt,aV as is,aW as as,aX as rs,aY as os,aZ as ls,a_ as cs,a$ as ds,b0 as jt,b1 as Ge,b2 as ps,b3 as hs}from"./vendor-DSn05bOG.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const p of i)if(p.type==="childList")for(const b of p.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&c(b)}).observe(document,{childList:!0,subtree:!0});function s(i){const p={};return i.integrity&&(p.integrity=i.integrity),i.referrerPolicy&&(p.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?p.credentials="include":i.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(i){if(i.ep)return;i.ep=!0;const p=s(i);fetch(i.href,p)}})();const Dt=Vt({palette:{mode:"dark",id:{main:"#20A79A",loading:"#a8a8a8ff",clip:Ke[900],background:"#FFFFFF"},timestamp:{main:"#8093E0"},lineground:{main:"#395553",clip:"#39254D"},primary:{main:"#20A79A",alt:"#71e2d7ff",background:"#FFFFFF"},secondary:{main:"#FFFFFF",background:"#17786E"},background:{main:"#424242",yellow:"#494913ff",teal:"#004d40",red:"#561b1b",orange:"#663c00",paper:"#202020"},error:{main:Ut.A400}}}),Lt=Vt({palette:{mode:"light",id:{main:"#12645B",loading:"#474747ff",clip:Ke[900],background:"#22B9AA"},timestamp:{main:"#304BC5"},lineground:{main:"#89A5A3",clip:"#C5B4E3"},primary:{main:"#12645B",alt:"#0a3b36",background:"#FFFFFF"},secondary:{main:"#000000",background:"#22B9AA"},background:{main:"#17786E",yellow:"#ffff00",teal:"#b2dfdb",red:"#ffcdd2",orange:"#ffe0b2",paper:"#f5f5f5"},error:{main:Ut.A400}}}),ms="/live-transcript/assets/doki-B2qFtmbA.jpg",us="/live-transcript/assets/mint-CrNjgZhD.jpg",gs=t=>({audioId:-1,setAudioId:n=>t({audioId:n})}),xs=(t,n)=>({clipPopupOpen:!1,clipMode:!1,clipStartIndex:-1,clipEndIndex:-1,clipInvalidBefore:-1,clipInvalidAfter:Number.MAX_SAFE_INTEGER,setClipPopupOpen:s=>{t({clipPopupOpen:s,clipMode:s?!1:n().clipMode})},toggleClipMode:()=>{const s=n().clipMode;t({clipMode:!s,clipStartIndex:-1,clipEndIndex:-1})},setClipStartIndex:s=>{const c=n(),{transcript:i,mediaType:p}=c;let b=-1,j=Number.MAX_SAFE_INTEGER;if(p!=="none"&&s!==-1){const m=i.findIndex(E=>E.id===s);if(m!==-1){const E=Math.max(0,m-it);for(let $=m-1;$>=E;$--)if(i[$].mediaAvailable===!1){b=i[$].id;break}const v=Math.min(i.length,m+it+1);for(let $=m+1;$<v;$++)if(i[$].mediaAvailable===!1){j=i[$].id;break}}}t({clipStartIndex:s,clipInvalidBefore:b,clipInvalidAfter:j})},setClipEndIndex:s=>t({clipEndIndex:s}),recalculateClipRange:()=>{const s=n(),{clipStartIndex:c}=s;s.setClipStartIndex(c)}}),fs=t=>({lineMenuId:-1,setLineMenuId:n=>t({lineMenuId:n})}),bs=t=>({tagPopupOpen:!1,tagPopupTimestamp:0,tagPopupText:"",setTagPopupOpen:n=>t({tagPopupOpen:n}),setTagPopupTimestamp:n=>t({tagPopupTimestamp:n}),setTagPopupText:n=>t({tagPopupText:n}),resetTagOffsetPopup:()=>t({tagPopupOpen:!1,tagPopupTimestamp:0,tagPopupText:""})}),js=t=>({serverStatus:"connecting",setServerStatus:n=>t({serverStatus:n})}),vs=t=>({activeId:"",activeTitle:"",startTime:0,mediaType:"none",mediaBaseUrl:"",isLive:!1,transcript:[],setActiveId:n=>t({activeId:n}),setActiveTitle:n=>t({activeTitle:n}),setStartTime:n=>t({startTime:n}),setMediaType:n=>t({mediaType:n}),setMediaBaseUrl:n=>t({mediaBaseUrl:n}),setIsLive:n=>t({isLive:n}),setTranscript:n=>t({transcript:n}),addTranscriptLine:n=>{t(s=>{const c=s.transcript.findIndex(i=>i.id===n.id);return c!==-1?{transcript:[...s.transcript.slice(0,c),n]}:{transcript:[...s.transcript,n]}})},updateLineMedia:(n,s,c=!0)=>{t(i=>({transcript:i.transcript.map(p=>{if(i.activeId!=n)return p;const b=s[p.id];return b?{...p,mediaAvailable:c,fileId:b}:p})}))},resetTranscript:()=>t({activeId:"",activeTitle:"",startTime:0,mediaType:"none",mediaBaseUrl:"",isLive:!1,transcript:[]})}),ys=t=>({theme:"system",density:"standard",timeFormat:"relative",transcriptHeight:"100%",enableTagHelper:!1,defaultOffset:-20,sidebarOpen:!0,devMode:!1,membershipKey:"",membershipInfo:null,useVirtualList:!1,setTheme:n=>t({theme:n}),setDensity:n=>t({density:n}),setTimeFormat:n=>t({timeFormat:n}),setTranscriptHeight:n=>t({transcriptHeight:n}),setEnableTagHelper:n=>t({enableTagHelper:n}),setDefaultOffset:n=>t({defaultOffset:n}),setSidebarOpen:n=>t({sidebarOpen:n}),setDevMode:n=>t({devMode:n}),setMembershipKey:n=>t({membershipKey:n}),setMembershipInfo:n=>t({membershipInfo:n}),setUseVirtualList:n=>t({useVirtualList:n})}),ws=t=>({metrics:[],lastLineReceivedAt:0,addMetric:n=>t(s=>{if(!s.devMode)return{metrics:s.metrics};const c=[...s.metrics,n];return c.length>200&&c.shift(),{metrics:c}}),setLastLineReceivedAt:n=>t({lastLineReceivedAt:n}),clearMetrics:()=>t({metrics:[],lastLineReceivedAt:0})}),Cs=(t,n)=>({formattedRows:[],controls:{},inputTags:"",setFormattedRows:s=>t({formattedRows:typeof s=="function"?s(n().formattedRows):s}),setControls:s=>t({controls:typeof s=="function"?s(n().controls):s}),setInputTags:s=>t({inputTags:s})}),Ts=t=>({pastStreamViewing:null,pastStreams:[],pastStreamTranscript:[],setPastStreamViewing:n=>t({pastStreamViewing:n}),setPastStreams:n=>t({pastStreams:n}),setPastStreamTranscript:n=>t({pastStreamTranscript:n}),resetPastStreams:()=>t({pastStreams:[],pastStreamViewing:null,pastStreamTranscript:[]}),resetPastStreamTranscript:()=>t({pastStreamTranscript:[]})}),l=ln()(cn((t,n,s)=>({...gs(t),...xs(t,n),...fs(t),...bs(t),...js(t),...vs(t),...ys(t),...ws(t),...Cs(t,n),...Ts(t)}),{name:"live-transcript-settings",partialize:t=>({theme:t.theme,density:t.density,timeFormat:t.timeFormat,transcriptHeight:t.transcriptHeight,enableTagHelper:t.enableTagHelper,defaultOffset:t.defaultOffset,sidebarOpen:t.sidebarOpen,devMode:t.devMode,membershipKey:t.membershipKey,membershipInfo:t.membershipInfo,useVirtualList:t.useVirtualList})})),Ue="https://api.duck-automata.com",$s="wss://api.duck-automata.com",it=30,$t=t=>{const n=[{name:"Doki",icon:e.jsx(dt,{src:ms,alt:"doki",sx:{width:t,height:t}}),value:"doki",testId:"key-icon-doki"},{name:"Mint",icon:e.jsx(dt,{src:us,alt:"mint",sx:{width:t,height:t}}),value:"mint",testId:"key-icon-mint"}];return l.getState().devMode&&n.push({name:"Test",icon:e.jsx(dt,{alt:"test",sx:{width:t,height:t},children:"T"}),value:"test",testId:"key-icon-test"},{name:"Mock",icon:e.jsx(dt,{alt:"mock",sx:{width:t,height:t,backgroundColor:"Highlight"},children:"M"}),value:"mock",testId:"key-icon-mock"}),n},Ss=()=>$t(120).map(n=>n.value),ks=({wsKey:t})=>{const n=`${$s}/${t}/websocket`,s=l(w=>w.setServerStatus),c=l(w=>w.setActiveId),i=l(w=>w.setActiveTitle),p=l(w=>w.setStartTime),b=l(w=>w.setMediaType),j=l(w=>w.setMediaBaseUrl),m=l(w=>w.setIsLive),E=l(w=>w.setTranscript),v=l(w=>w.addTranscriptLine),$=l(w=>w.updateLineMedia),k=l(w=>w.recalculateClipRange),O=l(w=>w.addMetric),f=l(w=>w.setLastLineReceivedAt),a=l(w=>w.resetTranscript),R=l(w=>w.resetPastStreams),D=l(w=>w.setAudioId),A=l(w=>w.setPastStreams),M=h.useRef(Date.now()),y=h.useRef(!1),[H,q]=h.useState(!0),U=h.useRef(null),ee=h.useRef(gt.ReadyState.CLOSED);h.useEffect(()=>{const w=()=>{!document.hidden?U.current?(clearTimeout(U.current),U.current=null,ee.current===gt.ReadyState.OPEN&&s("online")):q(!0):U.current=setTimeout(()=>{s("connecting"),q(!1),U.current=null},6e5)};return document.addEventListener("visibilitychange",w),()=>{document.removeEventListener("visibilitychange",w)}},[]);const{lastJsonMessage:N,sendMessage:W,readyState:ae}=dn(H?n:null,{share:!1,shouldReconnect:()=>H,reconnectAttempts:10,reconnectInterval:3e3,onOpen:()=>{s("loading"),y.current=!0},onClose:()=>{document.hidden||(y.current?s("reconnecting"):s("connecting"))},onError:()=>{document.hidden||(y.current?s("reconnecting"):s("connecting"))},onReconnectStop:()=>s("offline")});h.useEffect(()=>{ee.current=ae},[ae]),h.useEffect(()=>{y.current=!1,a(),R(),s("connecting"),D(-1)},[t]),h.useEffect(()=>{const w=setInterval(()=>{ae===gt.ReadyState.OPEN&&W(JSON.stringify({event:"ping",data:{timestamp:Date.now()}}))},45e3);return()=>clearInterval(w)},[ae,W]),h.useEffect(()=>{if(!N)return;const{event:w,data:Q}=N;switch(w){case"newLine":K(Q);break;case"newStream":ce(Q);break;case"pastStreams":me(Q);break;case"status":ue(Q);break;case"sync":z(Q),document.hidden||s("online");break;case"newMedia":he(Q);break;case"pong":{const{timestamp:ie}=Q,oe=Date.now()-ie;O({type:"ping",latency:oe,receivedAt:Date.now()});break}}},[N]);const z=w=>{if(!w)return;const Q=w.mediaBaseUrl??"";c(w.activeId??""),i(w.activeTitle??""),p(w.startTime?+w.startTime:0),b(w.mediaType??"none"),j(Q.replace(/\/+$/,"")),m(w.isLive??!1);let ie=[];w.transcript&&(ie=[...w.transcript]),E(ie)},K=w=>{if(!w)return;const Q=Date.now(),ie=Q-M.current;M.current=Q,f(Q);const{lineId:oe,timestamp:J,uploadTime:V,segments:P,mediaAvailable:Z}=w;O({type:"line",id:oe,receivedAt:Q,uploadTime:V,latency:0,interArrival:ie}),v({id:oe,timestamp:J,segments:P,mediaAvailable:Z})},ce=w=>{if(!w)return;const Q=w.mediaBaseUrl??"";c(w.activeId),i(w.activeTitle),p(+w.startTime),b(w.mediaType),j(Q.replace(/\/+$/,"")),m(w.isLive),E([])},me=w=>{w&&(w.streams?.length>0?A(w.streams):A([]))},ue=w=>{w&&(c(w.activeId),i(w.activeTitle),m(w.isLive))},he=w=>{w&&w?.files&&typeof w.files=="object"&&($(w.streamId,w.files),k())}},Es="/live-transcript/assets/settings-light-BJHd3xSm.png",Is="/live-transcript/assets/word-count-light-BSYusO3L.png",Rs="/live-transcript/assets/transcript-light-UKuiwA1R.png",Ms="/live-transcript/assets/linemenu-example-light-BTo-LRHm.png",As="/live-transcript/assets/audioplayer-desktop-light-CFfMTPye.png",Fs="/live-transcript/assets/tag-highlihgt-text-light-D0fNd4Z3.png",Ds="/live-transcript/assets/tag-menu-light-BcO6YYAk.png",Ls="/live-transcript/assets/message-ID-light-CByEdeW2.png",Bs="/live-transcript/assets/filled-out-tag-menu-light-Bzelh78H.png",Hs="/live-transcript/assets/sidebar-light-WtWMb_sN.png",Ps="/live-transcript/assets/clipping-started-light-DqF7Tv5_.png",Os="/live-transcript/assets/clipping-menu-light-Oh4HM0FT.png",Ns="/live-transcript/assets/clipping-popup-light-jvyLkVvG.png",Ws="/live-transcript/assets/devtools-controls-light-V2F83Tzf.png",zs="/live-transcript/assets/devtools-performance-light-C_PSSPJF.png",_s="/live-transcript/assets/formatter-disable-group-light-DdbJ3Znv.png",Vs="/live-transcript/assets/formatter-editing-chapter-light-bLuivaWp.png",Us="/live-transcript/assets/formatter-editing-tag-light-DjZvvtsV.png",Gs="/live-transcript/assets/formatter-enabledisable-light-DLdbXREh.png",qs="/live-transcript/assets/formatter-format-button-light-7KyglSkF.png",Js="/live-transcript/assets/formatter-format-button-extra-light-CT20mqgL.png",Ys="/live-transcript/assets/formatter-format-view-light-CBDBo6so.png",Xs="/live-transcript/assets/formatter-header-edit-light-CI1cibij.png",Zs="/live-transcript/assets/formatter-highlight-example-light-CU7elMNB.png",Qs="/live-transcript/assets/formatter-highlight-example-fix-light-QqjETomj.png",Ks="/live-transcript/assets/formatter-highlight-menu-light-CXWppHtv.png",ei="/live-transcript/assets/formatter-input-blank-light-BkAGhrvT.png",ti="/live-transcript/assets/formatter-offset-light-BBN0vSV6.png",ni="/live-transcript/assets/formatter-wordedit-light-CE9LoKEt.png",si="/live-transcript/assets/settings-dark-Cte4Uyxq.png",ii="/live-transcript/assets/word-count-dark-51UxYod5.png",ai="/live-transcript/assets/transcript-dark-BFMhcujz.png",ri="/live-transcript/assets/linemenu-example-dark-BvrCrSLd.png",oi="/live-transcript/assets/audioplayer-desktop-dark-BDh4r1bO.png",li="/live-transcript/assets/tag-highlihgt-text-dark-DAeGU9fL.png",ci="/live-transcript/assets/tag-menu-dark-Bs-Vs-8v.png",di="/live-transcript/assets/message-ID-dark-D329D2z8.png",pi="/live-transcript/assets/filled-out-tag-menu-dark-CxjqfbbG.png",hi="/live-transcript/assets/sidebar-dark-989wmSIr.png",mi="/live-transcript/assets/clipping-started-dark-BmwIkqBK.png",ui="/live-transcript/assets/clipping-menu-dark-CbWMxzAK.png",gi="/live-transcript/assets/clipping-popup-dark-Gg_lSnkB.png",xi="/live-transcript/assets/devtools-controls-dark-CAyWRwiW.png",fi="/live-transcript/assets/devtools-performance-dark-BWCUaQ8X.png",bi="/live-transcript/assets/formatter-disable-group-dark-BBlgqipJ.png",ji="/live-transcript/assets/formatter-editing-chapter-dark-P2l8MiV-.png",vi="/live-transcript/assets/formatter-editing-tag-dark-CTzOXR2s.png",yi="/live-transcript/assets/formatter-enabledisable-dark-146ulikx.png",wi="/live-transcript/assets/formatter-format-button-dark-8CFgIM_Q.png",Ci="/live-transcript/assets/formatter-format-button-extra-dark-9jZttez1.png",Ti="/live-transcript/assets/formatter-format-view-dark-C29H6vI5.png",$i="/live-transcript/assets/formatter-header-edit-dark-nKN0Sqk4.png",Si="/live-transcript/assets/formatter-highlight-example-dark-CG4vVd50.png",ki="/live-transcript/assets/formatter-highlight-example-fix-dark-D281gQ4I.png",Ei="/live-transcript/assets/formatter-highlight-menu-dark-d5Ogyj-k.png",Ii="/live-transcript/assets/formatter-input-blank-dark-D2tHx5Ue.png",Ri="/live-transcript/assets/formatter-offset-dark-CfR3g8Wn.png",Mi="/live-transcript/assets/formatter-wordedit-dark-CJHCu5ev.png",pe=({src:t,width:n="100%",alt:s=""})=>e.jsx(Te,{elevation:6,sx:{my:2,p:.5,backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1,width:"fit-content",maxWidth:"100%",mx:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx("img",{src:t,alt:s,style:{width:n,maxWidth:"100%",height:"auto",display:"block",margin:"0 auto"}})});function Ai({open:t,setOpen:n}){const s=l(E=>E.theme),c=Se("(prefers-color-scheme: dark)"),i=s==="dark"||s==="system"&&c,p=l(E=>E.enableTagHelper),b=l(E=>E.setEnableTagHelper),j={settings:i?si:Es,wordCount:i?ii:Is,transcript:i?ai:Rs,linemenu:i?ri:Ms,audioplayerDesktop:i?oi:As,tagHighlightText:i?li:Fs,tagMenu:i?ci:Ds,messageId:i?di:Ls,filledOutTagMenu:i?pi:Bs,sidebar:i?hi:Hs,clippingStarted:i?mi:Ps,clippingMenuDownload:i?ui:Os,clippingPopup:i?gi:Ns,devtoolsControls:i?xi:Ws,devtoolsPerformance:i?fi:zs,formatterDisableGroup:i?bi:_s,formatterEditingChapter:i?ji:Vs,formatterEditingTag:i?vi:Us,formatterEnableDisable:i?yi:Gs,formatterFormatButton:i?wi:qs,formatterFormatButtonExtra:i?Ci:Js,formatterFormatView:i?Ti:Ys,formatterHeaderEdit:i?$i:Xs,formatterHighlightExample:i?Si:Zs,formatterHighlightExampleFix:i?ki:Qs,formatterHighlightMenu:i?Ei:Ks,formatterInputBlank:i?Ii:ei,formatterOffset:i?Ri:ti,formatterWordEdit:i?Mi:ni},m=()=>{n(!1)};return e.jsx("div",{children:e.jsxs(et,{open:t,onClose:m,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(at,{id:"alert-dialog-title",children:"How to Use Live Transcript"}),e.jsx(tt,{children:e.jsxs("div",{children:[e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Settings"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Settings are at the left of the page. Click the cogwheel icon to view the settings menu."}),e.jsx(pe,{src:j.settings,width:"75%"}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"There are currently 6 settings. All settings are stored in a cookie and persist across sessions."}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Theme: Select the color theme of the site. Light, Dark, or System default.",e.jsx("blockquote",{children:"System default will use whatever you set in your operating system. This is set by default."})]}),e.jsxs("li",{children:["Density: How much space should be between lines.",e.jsx("blockquote",{children:"Select whichever makes it easier to read."})]}),e.jsxs("li",{children:["Time Format: How you want the timestamp for each line to be formatted.",e.jsx("blockquote",{children:"Relative displays the time since the stream has started. Local displays the time in your local timezone."})]}),e.jsxs("li",{children:["Transcript Height: How tall should the transcript be.",e.jsx("blockquote",{children:"100% means it will go all the way to the bottom of the page. Select a smaller value if you want the bottom to be higher up on the page."})]}),e.jsxs("li",{children:["Enable Tag Helper",e.jsx("blockquote",{children:"This enables a feature to help time a tag with the text that appears in the transcript. This will be explained further in Tagging Feature."})]}),e.jsxs("li",{children:["Developer Mode",e.jsx("blockquote",{children:"Enables technical details for debugging, such as the Live Timer and server status metrics."})]})]})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Sidebar"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Allows you to easily jump between pages and streamers. Located on the left of your screen."}),e.jsx(pe,{src:j.sidebar,width:"50%"}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Sidebar is broken up into 3 parts."}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Transcripts",e.jsx("blockquote",{children:"Select which transcripts you wish to load. Currently there are: Doki and Mint."})]}),e.jsxs("li",{children:["Pages",e.jsx("blockquote",{children:"Select how you want to use the transcripts. Either view them, graph them, or use it to fix tags."})]}),e.jsxs("li",{children:["Other",e.jsx("blockquote",{children:"General options. View github url, open the help menu (this), or change the site settings."})]})]}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Note: you must select a transcript before you can select a page."})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Transcript Viewer"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The transcript viewer allows you to review what was said during the stream. This updates in real time, so there is no need to refresh."}),e.jsx(o,{variant:"body1",color:"error",gutterBottom:!0,children:"NOTE: The transcripts are not guaranteed to be accurate to what was said on stream, or if the streamer said it, or it was said in game or by someone else."}),e.jsx(pe,{src:j.transcript}),"There are 4 parts to the transcript page.",e.jsxs("ol",{children:[e.jsx("li",{children:"The title"}),e.jsx("li",{children:"The search bar"}),e.jsx("li",{children:"The transcript"}),e.jsx("li",{children:"The live/pause/jump menu"})]}),"The transcript is broken up into 3 parts.",e.jsxs("ol",{children:[e.jsx("li",{children:"Options (three dots in green)"}),e.jsx("li",{children:"The timestamp"}),e.jsx("li",{children:"The text"})]}),"Clicking on the options button will open a menu. This is where you can",e.jsxs("ul",{children:[e.jsx("li",{children:"Start a clip (explained more in the Clipping section)"}),e.jsx("li",{children:"Play or download the audio"}),e.jsx("li",{children:"Open the stream to this spot if DVR or Vod is available"}),e.jsx("li",{children:"Copy the unix timestamp of when the line starts"})]}),e.jsx(pe,{src:j.linemenu}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Live vs Paused vs Offline"}),e.jsxs(o,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Live:"})," The transcript auto-scrolls to show the newest messages."]}),e.jsxs(o,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Paused:"})," Auto-scroll stops. This happens automatically when you scroll up, jump to the top, or use the search bar."]}),e.jsxs(o,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Offline:"})," Same as Paused, but is forced when the stream goes offline. This means you can't go to live mode since there is no stream to scroll to."]}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:'To resume Live mode, scroll to the bottom, click the play button, or the "Jump to Bottom" arrow. If you are searching, you will need to click "Searching" or clear the search bar and go to the bottom.'}),e.jsx("br",{}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Log Height"}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"You can adjust how much of the screen the transcript takes up in the Settings menu (Full, 90%, 75%, 50%)."})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Audio Player"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"body1",gutterBottom:!0,children:'When you click on a line id and select "Play Audio", it will open the audio player and start playing the audio of that line.'}),e.jsx(pe,{src:j.audioplayerDesktop}),"To keep track of the line it is playing, it will highlight that line in purple. You can do the following with the audio player:",e.jsxs("ol",{children:[e.jsx("li",{children:'Close it by clicking the "X" button'}),e.jsx("li",{children:"Download the audio by clicking the download button"}),e.jsx("li",{children:"Jump forward/backward one line"}),e.jsx("li",{children:"Play, pause, mute, seek"})]}),"Important things to note",e.jsxs("ol",{children:[e.jsx("li",{children:"If you spam the forward/backward button, the server will throttle you. If you do spam it, just give it a couple of seconds for the throttle to reset."}),e.jsx("li",{children:"The audio will automatically stop when you go to another page or streamer"}),e.jsx("li",{children:"If the audio fails to load, it will not show anything"})]})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Clipping"})}),e.jsxs(Oe,{children:["Clipping allows you to generate a media clip that spans multiple lines in the transcript. The benefits with using this instead of downloading each line separately is",e.jsxs("ul",{children:[e.jsx("li",{children:"Significantly faster since you do not have to combine them manually"}),e.jsx("li",{children:"No artifacts or missed media between lines due to encoding issues"}),e.jsx("li",{children:"Clearly see what you are clipping"})]}),'The type of clipping (m4a, mp4, or disabled) is determined by the server on what the server is storing. Depending on this, you will be able to see "download m4a", "download mp4", or nothing at all. The type of clipping can be changed when needed.',e.jsx(o,{variant:"body1",gutterBottom:!0}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:'To start clipping, click on the triple dots on the line you want to clip; and select "Start Clip". This will do the following:'}),e.jsxs("ul",{children:[e.jsx("li",{children:"Mark that line as one of the ends of the clip (either start or finish depending on the next id you pick)"}),e.jsx("li",{children:"Highlight all triple dots next to it in orange to depict the range of the clip. Clips are limited in how large they can get."}),e.jsx("li",{children:"Any lines that will be in the clip will now be highlighted in purple."})]}),e.jsx(pe,{src:j.clippingStarted}),'To mark the second end of the clip, click on one of the orange triple dots and click "Process Clip".',e.jsx(pe,{src:j.clippingMenuDownload}),e.jsx(o,{variant:"caption",children:"Caption: as you can see, the lines between 631 (the id I started with) and 634 (the id I just clicked on) are highlighted. This visually shows you what lines will be included in the clip."}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"When you click on the process button, a popup will appear. From here, give the clip a name and click download to finish the clipping process."}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Depending on what media type the server is storing, you will be able to download m4a, mp4, or nothing."}),e.jsx(pe,{src:j.clippingPopup}),"Important notes:",e.jsxs("ul",{children:[e.jsx("li",{children:"At any point, you can click Reset Clip to get out of the clipping process"}),e.jsx("li",{children:"If one of the lines in a clip does not have any media (either it did not get saved or it was deleted), then the whole clip will get rejected and you will land on a Server Error page."}),e.jsx("li",{children:"You cannot clip a single line. Just download the line audio instead"}),e.jsx("li",{children:"There is a limit to how many lines can go into a single clip. If you really want to increase the limit, just DM me and I will make the change."})]})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Word Count"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Word Count allows you to view the usage of a word or text in real time over the course of the stream. The graph and values will automatically update."}),e.jsx(pe,{src:j.wordCount}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The only requirement is that the word is 3 or more characters long."}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"To view the graph value, either hover over it with your mouse if you are on PC, or tap/drag on the graph if you are on mobile."})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Tag Formatter"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Input View"}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The tag formatter allows you to format, organize, edit, and delete tags. Everything is saved locally and is unique to each streamer."}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"To use it, click on the tag formatter button in the top right corner of the page."}),e.jsx(pe,{src:j.formatterInputBlank}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:'When you first open the tag formatter, you will see an empty input field. Paste the tags and press "Format Tags", or click "Format From Clipboard" to automatically use the tags from your clipboard.'}),e.jsx(pe,{src:j.formatterFormatButton}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"If you go back to this page after formatting, you will be given the option to reset data, reformat, or go back to the format view."}),e.jsx(pe,{src:j.formatterFormatButtonExtra}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Format View"}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"After clicking format, you go to the format view. Here you will see a list of tags, a list of headers, and a section to bulk edit tags."}),e.jsx(pe,{src:j.formatterFormatView}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The Headers section is a list of groups, chapters, and birthday group, in order they appear in the formatted tags. Here you can:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Click on a header to jump to its position in the tags."}),e.jsx("li",{children:"Click on the checkbox to enable/disable a header. Disabling a group will put its tags back to the original spot. Disabling a chapter will just remove the chapter header."}),e.jsx("li",{children:"Organize a group by moving it up or down by clicking on the arrows."})]}),e.jsx(pe,{src:j.formatterHeaderEdit}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The Tags section shows what the output will look like. Here you can:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Enable or disable a tag. Disabling a tag will remove it from the output."}),e.jsx("li",{children:"Edit a tag or header by clicking on the edit button. Tags and chapters can also edit the timestamp."})]}),e.jsx(pe,{src:j.formatterEditingTag}),e.jsx(pe,{src:j.formatterEditingChapter}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"If you disable all tags in a header, it will disable the header and remove it from the output."}),e.jsx(pe,{src:j.formatterDisableGroup}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The Bulk Edit section allows you to edit multiple tags at once. There are currently 4 actions you can perform:"}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"1. Offset Timestamps: enter the start and end timestamp, and the offset, in the format hh:mm:ss. Click on the plus to add the offset to all tags in the range. Click on the minus to subtract the offset from all tags in the range."}),e.jsx(pe,{src:j.formatterOffset}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"2. Enable and Disable Tags: enter the start and end timestamp in the format hh:mm:ss. Click on enable or disable to enable or disable all tags in the range."}),e.jsx(pe,{src:j.formatterEnableDisable}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"3. Word Edit: enter a word to find and replace it with another word. Clicking on replace all will replace all instances of the word with the replace word."}),e.jsx(pe,{src:j.formatterWordEdit}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"4. Highlight Timestamps: enableing this will highlight all tags that are too close to each other. The seconds value defines how close they can be. This is useful for finding tags that could be duplicates."}),e.jsx(pe,{src:j.formatterHighlightMenu}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"When highlight is turned on, any close tags will be highlighted in yellow."}),e.jsx(pe,{src:j.formatterHighlightExample}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Disabling one of the close tags will remove the highlight (assuming there are no other close tags to it)."}),e.jsx(pe,{src:j.formatterHighlightExampleFix})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Tagging Feature"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The tagging feature allows you to time a tag to a specific point in the transcript. This feature is disabled by default - enable it by toggling the switch below. You can also enable/disable it in the settings."}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",mt:1},children:[e.jsxs(o,{variant:"body1",sx:{fontWeight:"bold"},gutterBottom:!0,children:["Tagging Feature: ",p?"Enabled":"Disabled"]}),e.jsx(We,{checked:p,onChange:E=>b(E.target.checked),name:"enableTagHelper"})]}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Once enabled, you will be able to hover over the text in the transcript and click specific sections (denoted by the colored box that appears)."}),e.jsx(pe,{src:j.tagHighlightText}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:'These sections denote a specific part where you can set the tag to (the tags will be set to the beginning of the section. For example, using the image above, the tag will be set to the word "Oh").'}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Once you find the section you want to time a tag to; click it and a menu will appear."}),e.jsx(pe,{src:j.tagMenu}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"This is the tagging alignment menu. It takes the discord message ID of your tag, and calculates the offset you need for it to align with the beginning of the section you selected."}),"If you do not know how to get the message ID of your tag:",e.jsxs("ol",{children:[e.jsxs("li",{children:["Enable ",e.jsx("strong",{children:"Discord"})," developer mode. User Settings ","->"," Advanced"," ","->"," Enable Developer Mode"]}),e.jsx("li",{children:"Right-click on your message and click Copy Message ID"})]}),e.jsx(pe,{src:j.messageId,width:"auto"}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"The default offset is whatever your server's tagger bot is set to. For DPS, it is -20. This value is also stored in local storage, so you will only have to change it once."}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Once both values are set, it will display the adjust command to run. As well as enable the button Copy Command to copy the command to your clipboard."}),e.jsx(pe,{src:j.filledOutTagMenu}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:'Using the image above, after pasting the command into discord, the tag will be timed exactly to "Gotta". If maybe a half second before it (we floor the timestamps).'}),e.jsx("br",{}),"Note:",e.jsxs("ol",{children:[e.jsx("li",{children:"As said above, this will time the tag to the beginning of the section you clicked. This means that if an entire line is one section, it will time it to go at the beginning of that line. The only way to make it start in the middle of a section is to guess how long a section is and change the offset accordingly."}),e.jsx("li",{children:"The timings are perfect. Because of this, you might want to move the tag back by one second to give the YT player time to start the video/audio. But from my testing, it's not necessary."})]})]})]}),e.jsxs(He,{children:[e.jsx(Pe,{expandIcon:e.jsx(Fe,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(o,{children:"Developer Mode"})}),e.jsxs(Oe,{children:[e.jsx(o,{variant:"body1",gutterBottom:!0,children:"Developer Mode enables technical details primarily used for debugging and performance monitoring."}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"To open the Dev Tools, enable Developer Mode in Settings and click on the Dev Tools icon that appears below the Tag Fixer icon and above the GitHub icon."}),e.jsx(o,{variant:"body1",gutterBottom:!0,children:"In the Dev Tools, there are two pages:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Controls:"})," Allows you to control the transcripts and simulate live streams to help debug."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Performance:"})," Detailed performance metrics used to show if there are any network or processing issues."]})]}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:e.jsx("strong",{children:"Controls"})}),e.jsxs(o,{variant:"body1",gutterBottom:!0,children:["Broken up into 5 tabs:",e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clear Transcript:"})," Deletes all transcript data for the key you are on."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Stream State:"})," Allows you to change the stream data such as title, start time, media type, and live status."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Add Line:"})," Allows you to add a line to the transcript."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Simulation:"})," Allows you to repeatedly add lines to the transcript every interval."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Delete Line:"})," Allows you to delete a specific line from the transcript."]})]})]}),e.jsx(pe,{src:j.devtoolsControls}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:e.jsx("strong",{children:"Performance"})}),e.jsxs(o,{variant:"body1",gutterBottom:!0,children:["Broken up into 4 tabs:",e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Metrics:"})," Shows the metrics of the website and the current stream."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Server Upload Time (s):"})," Graph of the time it takes to upload to the server."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Server-Client Latency (s):"})," Graph of the latency between when the server received the message and when the client received the message."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Message Inter-arrival Time (s):"})," Graph of the time between when a message was received and when the next message was received."]})]})]}),e.jsx(pe,{src:j.devtoolsPerformance})]})]})]})}),e.jsx(rt,{children:e.jsx(ne,{onClick:m,children:"Close"})})]})})}const Fi=({open:t,setOpen:n})=>{const s=l(a=>a.theme),c=l(a=>a.density),i=l(a=>a.timeFormat),p=l(a=>a.transcriptHeight),b=l(a=>a.enableTagHelper),j=l(a=>a.devMode),m=l(a=>a.setTheme),E=l(a=>a.setDensity),v=l(a=>a.setTimeFormat),$=l(a=>a.setTranscriptHeight),k=l(a=>a.setEnableTagHelper),O=l(a=>a.setDevMode),f=()=>{n(!1)};return e.jsxs(et,{open:t,onClose:f,maxWidth:"xs",fullWidth:!0,children:[e.jsx(at,{children:"Settings"}),e.jsx(tt,{children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsxs(Ve,{fullWidth:!0,variant:"filled",children:[e.jsx(nt,{id:"theme-select-label",children:"Theme"}),e.jsxs(Je,{labelId:"theme-select-label",name:"theme",value:s,onChange:a=>m(a.target.value),children:[e.jsx(le,{value:"light",children:"Light"}),e.jsx(le,{value:"system",children:"System"}),e.jsx(le,{value:"dark",children:"Dark"})]})]}),e.jsxs(Ve,{fullWidth:!0,variant:"filled",children:[e.jsx(nt,{id:"density-select-label",children:"Density"}),e.jsxs(Je,{labelId:"density-select-label",name:"density",value:c,onChange:a=>E(a.target.value),children:[e.jsx(le,{value:"compact",children:"Compact"}),e.jsx(le,{value:"standard",children:"Standard"}),e.jsx(le,{value:"comfortable",children:"Comfortable"})]})]}),e.jsxs(Ve,{fullWidth:!0,variant:"filled",children:[e.jsx(nt,{id:"time-format-select-label",children:"Time Format"}),e.jsxs(Je,{labelId:"time-format-select-label",name:"timeFormat",value:i,onChange:a=>v(a.target.value),children:[e.jsx(le,{value:"relative",children:"Relative"}),e.jsx(le,{value:"local",children:"Local"}),e.jsx(le,{value:"UTC",children:"UTC"})]})]}),e.jsxs(Ve,{fullWidth:!0,variant:"filled",children:[e.jsx(nt,{id:"transcript-height-select-label",children:"Transcript Height"}),e.jsxs(Je,{labelId:"transcript-height-select-label",name:"transcriptHeight",value:p,onChange:a=>$(a.target.value),children:[e.jsx(le,{value:"100%",children:"100%"}),e.jsx(le,{value:"90%",children:"90%"}),e.jsx(le,{value:"75%",children:"75%"}),e.jsx(le,{value:"50%",children:"50%"})]})]}),e.jsx(Xe,{control:e.jsx(We,{checked:b,onChange:a=>k(a.target.checked),name:"enableTagHelper"}),label:"Enable Tag Helper"}),e.jsx(Xe,{control:e.jsx(We,{checked:j,onChange:a=>O(a.target.checked),name:"devMode"}),label:"Developer Mode"})]})}),e.jsx(rt,{children:e.jsx(ne,{onClick:f,children:"Close"})})]})},Di=(t,n,s,c)=>{if(!(!n||!s||!c))return t===""?`${Ue}/${n}/stream/${s}/audio/${c}.m4a`:`${t}/${n}/${s}/audio/${c}.m4a`},en=(t,n,s,c,i)=>{if(!(!n||!s||!c))return t===""?`${Ue}/${n}/download/${s}/audio/${c}.m4a?name=${s}_${i}`:`${t}/${n}/${s}/audio/${c}.m4a?download=true&name=${s}_${i}.m4a`},Bt=(t,n,s,c,i)=>{if(!(!n||!s||!c))return t===""?`${Ue}/${n}/stream/${s}/clips/${c}.${i}`:`${t}/${n}/${s}/clips/${c}.${i}`},vt=(t,n,s,c,i,p)=>{if(p||(p=`clip_${s}_${c}`),!(!n||!s||!c||!i))return t===""?`${Ue}/${n}/download/${s}/clips/${c}.${i}?name=${encodeURIComponent(p)}`:`${t}/${n}/${s}/clips/${c}.${i}?download=true&name=${encodeURIComponent(p)}.${i}`},tn=(t,n,s,c)=>{if(!(!n||!s||!c))return t===""?`${Ue}/${n}/frame/${s}/${c}.jpg`:`${t}/${n}/${s}/frame/${c}.jpg`};function Li({wsKey:t,width:n}){const s=l(M=>M.audioId),c=l(M=>M.setAudioId),i=l(M=>M.mediaBaseUrl),p=l(M=>M.transcript),b=l(M=>M.pastStreamViewing),j=l(M=>M.pastStreamTranscript),m=l(M=>M.activeId),E=b||m,v=b?j:p,$=v.find(M=>M.id===s),k=mt(),O=Se("(max-width:768px)"),f=Di(i,t,E,$?.fileId),a=en(i,t,E,$?.fileId,s),R=400,D=()=>{c(-1)},A=()=>{window.open(a,"_blank")};return!f||s<0||s>=v.length?null:e.jsx(pn,{position:"fixed",sx:{top:"auto",bottom:0,background:"green",left:O?0:`${n-R+9}px`,width:O?"100%":R},children:e.jsx(hn,{children:e.jsx(u,{sx:{flexGrow:1,display:"flex"},children:e.jsx(mn,{autoPlay:!0,src:f,showDownloadProgress:!0,showFilledProgress:!0,showFilledVolume:!0,showJumpControls:!1,showSkipControls:!0,style:{background:k.palette.primary.main},customAdditionalControls:[e.jsx(fe,{title:"Close",children:e.jsx($e,{onClick:D,children:e.jsx(un,{style:{color:"black"}})})},"close"),e.jsx(fe,{title:"Download",children:e.jsx($e,{onClick:A,children:e.jsx(gn,{style:{color:"black"}})})},"download")],onClickNext:()=>c(s<v.length-1?s+1:v.length-1),onClickPrevious:()=>c(s>0?s-1:0)})})})})}const Ht=t=>{const{children:n,value:s,index:c,...i}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==c,id:`simple-tabpanel-${c}`,"aria-labelledby":`simple-tab-${c}`,...i,children:s===c&&e.jsx(u,{sx:{p:3},children:n})})};function Bi({open:t,setOpen:n}){const[s,c]=h.useState(0),i=l(x=>x.transcript),p=l(x=>x.resetTranscript),b=l(x=>x.addTranscriptLine),j=l(x=>x.updateLineMedia),m=l(x=>x.recalculateClipRange),E=l(x=>x.setTranscript),v=l(x=>x.metrics),$=l(x=>x.clearMetrics),k=l(x=>x.activeTitle),O=l(x=>x.setActiveTitle),f=l(x=>x.startTime),a=l(x=>x.setStartTime),R=l(x=>x.mediaType),D=l(x=>x.setMediaType),A=l(x=>x.isLive),M=l(x=>x.setIsLive),[y,H]=h.useState(""),[q,U]=h.useState(""),[ee,N]=h.useState([{text:"",timestamp:""}]),[W,ae]=h.useState(""),[z,K]=h.useState(1),[ce,me]=h.useState(1e3),[ue,he]=h.useState(!1),[w,Q]=h.useState(""),[ie,oe]=h.useState(!0),[J,V]=h.useState(0),[P,Z]=h.useState({used:0,total:0}),X=()=>n(!1),Y=(x,te)=>c(te),de=()=>{p(),$()},ye=()=>{N([...ee,{text:"",timestamp:""}])},je=(x,te,xe)=>{const be=[...ee];be[x][te]=xe,N(be)},se=x=>{const te=ee.filter((xe,be)=>be!==x);N(te)},we=()=>{const x=parseInt(y),te=parseInt(q)||Math.floor(Date.now()/1e3),xe=ee.map(be=>({text:be.text,timestamp:parseInt(be.timestamp)||te}));isNaN(x)||(b({id:x,timestamp:te,segments:xe}),H(String(x+1)))},ke=()=>{const x=parseInt(W);if(!isNaN(x)){const te=i.filter(xe=>xe.id!==x);E(te)}};h.useEffect(()=>{let x,te=z;return ue&&(x=setInterval(()=>{b({id:te,timestamp:Math.floor(Date.now()/1e3),segments:[{text:`Simulated Line ${te}`,timestamp:Math.floor(Date.now()/1e3)}]}),te++},ce)),()=>clearInterval(x)},[ue,ce,z,b]);const Ce=()=>he(!0),Le=()=>he(!1),Re=()=>{const x=w.split(",").map(te=>parseInt(te.trim())).filter(te=>!isNaN(te));x.length>0&&(j(x,ie),m())};h.useEffect(()=>{if(!t||s!==1)return;let x=0,te=performance.now(),xe,be;const Be=()=>{const Ee=performance.now();x++,Ee>=te+1e3&&(V(Math.round(x*1e3/(Ee-te))),x=0,te=Ee),xe=requestAnimationFrame(Be)};Be();const Me=()=>{performance.memory&&Z({used:Math.round(performance.memory.usedJSHeapSize/1024/1024),total:Math.round(performance.memory.totalJSHeapSize/1024/1024)})};return be=setInterval(Me,1e3),Me(),()=>{cancelAnimationFrame(xe),clearInterval(be)}},[t,s]);const L=Date.now(),d=v.filter(x=>x.type==="ping"),C=v.filter(x=>x.type==="line"),g=d.map(x=>x.latency/1e3),T=d.map(x=>(x.receivedAt-L)/1e3),I=C.map(x=>(x.interArrival||0)/1e3),F=C.map(x=>(x.receivedAt-L)/1e3),S=C.map(x=>(x.uploadTime||0)/1e3),B=x=>{const te=Math.abs(x),xe=Math.floor(te/60),be=Math.floor(te%60),Be=`${String(xe).padStart(2,"0")}:${String(be).padStart(2,"0")}`;return x<0?`-${Be}`:Be},_=g.length>0?(g.reduce((x,te)=>x+te,0)/g.length).toFixed(3):0,G=I.length>0?(I.reduce((x,te)=>x+te,0)/I.length).toFixed(3):0,ge=S.length>0?(S.reduce((x,te)=>x+te,0)/S.length).toFixed(3):0;return e.jsxs(et,{open:t,onClose:X,maxWidth:"md",fullWidth:!0,children:[e.jsx(at,{"data-testid":"devtools-title",children:"Dev Tools"}),e.jsxs(tt,{children:[e.jsx(u,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ct,{value:s,onChange:Y,"aria-label":"dev tools tabs",children:[e.jsx(Ze,{label:"Controls"}),e.jsx(Ze,{label:"Performance"})]})}),e.jsx(Ht,{value:s,index:0,children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(u,{children:e.jsx(ne,{variant:"contained",color:"error",onClick:de,"data-testid":"devtools-clear-transcript",children:"Clear Transcript"})}),e.jsxs(u,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(o,{variant:"h6",children:"Stream State"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(re,{label:"Active Title",size:"small","data-testid":"devtools-active-title",value:k,onChange:x=>O(x.target.value),sx:{minWidth:200}}),e.jsx(re,{label:"Start Time",size:"small","data-testid":"devtools-start-time",value:f,onChange:x=>a(Number(x.target.value)),type:"number"}),e.jsxs(Ve,{size:"small",sx:{minWidth:120},children:[e.jsx(nt,{children:"Media Type"}),e.jsxs(Je,{"data-testid":"devtools-media-type",value:R,label:"Media Type",onChange:x=>D(x.target.value),children:[e.jsx(le,{value:"none",children:"None"}),e.jsx(le,{value:"audio",children:"Audio"}),e.jsx(le,{value:"video",children:"Video"})]})]}),e.jsx(Xe,{control:e.jsx(We,{"data-testid":"devtools-is-live",checked:A,onChange:x=>M(x.target.checked)}),label:"Is Live"})]})]}),e.jsxs(u,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(o,{variant:"h6",children:"Add Line"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(re,{label:"ID",size:"small","data-testid":"devtools-line-id",value:y,onChange:x=>H(x.target.value),type:"number"}),e.jsx(re,{label:"Timestamp",size:"small","data-testid":"devtools-line-timestamp",value:q,onChange:x=>U(x.target.value),type:"number"})]}),e.jsx(o,{variant:"subtitle2",children:"Segments"}),ee.map((x,te)=>e.jsxs(u,{sx:{display:"flex",gap:1,mb:1,alignItems:"center"},children:[e.jsx(re,{label:"Text",size:"small","data-testid":"devtools-segment-text",fullWidth:!0,value:x.text,onChange:xe=>je(te,"text",xe.target.value)}),e.jsx(re,{label:"Ts",size:"small","data-testid":"devtools-segment-timestamp",sx:{width:100},value:x.timestamp,onChange:xe=>je(te,"timestamp",xe.target.value)}),e.jsx($e,{size:"small","data-testid":"devtools-remove-segment",onClick:()=>se(te),children:e.jsx(xn,{})})]},te)),e.jsx(ne,{"data-testid":"devtools-add-segment",startIcon:e.jsx(fn,{}),onClick:ye,children:"Add Segment"}),e.jsx(u,{sx:{mt:2},children:e.jsx(ne,{"data-testid":"devtools-add-line",variant:"contained",onClick:we,children:"Add Line"})})]}),e.jsxs(u,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(o,{variant:"h6",children:"Simulation"}),e.jsxs(u,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(re,{"data-testid":"devtools-sim-start-id",label:"Start ID",size:"small",value:z,onChange:x=>K(Number(x.target.value)),type:"number"}),e.jsx(re,{"data-testid":"devtools-sim-interval",label:"Interval (ms)",size:"small",value:ce,onChange:x=>me(Number(x.target.value)),type:"number"}),ue?e.jsx(ne,{"data-testid":"devtools-stop-sim",variant:"contained",color:"warning",startIcon:e.jsx(bn,{}),onClick:Le,children:"Stop"}):e.jsx(ne,{"data-testid":"devtools-start-sim",variant:"contained",color:"success",startIcon:e.jsx(Gt,{}),onClick:Ce,children:"Start"})]})]}),e.jsxs(u,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(o,{variant:"h6",children:"Media Availability"}),e.jsxs(u,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(re,{"data-testid":"devtools-media-ids",label:"Line IDs (comma-separated)",size:"small",value:w,onChange:x=>Q(x.target.value),sx:{flexGrow:1}}),e.jsx(Xe,{"data-testid":"devtools-media-available",control:e.jsx(We,{checked:ie,onChange:x=>oe(x.target.checked)}),label:ie?"Available":"Unavailable"}),e.jsx(ne,{"data-testid":"devtools-set-media-availability",variant:"contained",onClick:Re,children:"Set"})]})]}),e.jsxs(u,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(o,{variant:"h6",children:"Delete Line"}),e.jsxs(u,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(re,{"data-testid":"devtools-delete-id",label:"ID to Delete",size:"small",value:W,onChange:x=>ae(x.target.value),type:"number"}),e.jsx(ne,{"data-testid":"devtools-delete-line",variant:"contained",color:"error",onClick:ke,children:"Delete"})]})]})]})}),e.jsxs(Ht,{value:s,index:1,children:[e.jsxs(_e,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(_e,{item:!0,xs:2.4,children:e.jsxs(Te,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"FPS"}),e.jsx(o,{variant:"h6",children:J})]})}),e.jsx(_e,{item:!0,xs:2.4,children:e.jsxs(Te,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Memory (Used/Total)"}),e.jsx(o,{variant:"h6",children:P.used>0?`${P.used}/${P.total} MB`:"N/A"})]})}),e.jsx(_e,{item:!0,xs:2.4,children:e.jsxs(Te,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Avg Latency"}),e.jsxs(o,{variant:"h6",children:[_," s"]})]})}),e.jsx(_e,{item:!0,xs:2.4,children:e.jsxs(Te,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Avg Inter-arrival"}),e.jsxs(o,{variant:"h6",children:[G," s"]})]})}),e.jsx(_e,{item:!0,xs:2.4,children:e.jsxs(Te,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Avg Upload Time"}),e.jsxs(o,{variant:"h6",children:[ge," s"]})]})})]}),e.jsx(o,{variant:"h6",children:"Server Upload Time (s)"}),S.length>0?e.jsx(lt,{xAxis:[{data:F,valueFormatter:B,label:"Time ago (mm:ss)"}],yAxis:[{min:0}],series:[{data:S,label:"Upload Time",color:"#8884d8",curve:"catmullRom"}],height:250}):e.jsx(o,{color:"text.secondary",children:"No data yet"}),e.jsx(o,{variant:"h6",sx:{mt:2},children:"Server-Client Latency (s)"}),g.length>0?e.jsx(lt,{xAxis:[{data:T,valueFormatter:B,label:"Time ago (mm:ss)"}],yAxis:[{min:0}],series:[{data:g,label:"Latency",curve:"catmullRom"}],height:250}):e.jsx(o,{color:"text.secondary",children:"No data yet"}),e.jsx(o,{variant:"h6",sx:{mt:2},children:"Message Inter-arrival Time (s)"}),I.length>0?e.jsx(lt,{xAxis:[{data:F,valueFormatter:B,label:"Time ago (mm:ss)"}],yAxis:[{min:0}],series:[{data:I,label:"Inter-arrival",color:"#82ca9d",curve:"catmullRom"}],height:250}):e.jsx(o,{color:"text.secondary",children:"No data yet"})]})]}),e.jsx(rt,{children:e.jsx(ne,{"data-testid":"devtools-close",onClick:X,children:"Close"})})]})}function Hi({wsKey:t,children:n}){const s=qt(),c=Tt(),i=l(z=>z.sidebarOpen),p=l(z=>z.setSidebarOpen),b=l(z=>z.setAudioId),j=l(z=>z.setClipStartIndex),m=l(z=>z.setClipEndIndex),E=l(z=>z.devMode),[v,$]=h.useState(!1),[k,O]=h.useState(!1),[f,a]=h.useState(!1),[R,D]=h.useState(!1),[A,M]=h.useState(window.innerWidth),y=Se("(max-width:768px)"),H=y?180:200,q=60,U=[{name:"View",icon:e.jsx(Sn,{}),value:"",testId:"page-button-view"},{name:"Graph",icon:e.jsx(kn,{}),value:"graph",testId:"page-button-graph"},{name:"Tag Formatter",icon:e.jsx(En,{}),value:"tagFixer",testId:"page-button-tagFixer"}],ee=()=>{y?$(!v):p(!i)},N=()=>{y&&$(!1),c("/"),b(-1),j(-1),m(-1)},W=z=>{y&&$(!1);const K=s.pathname.split("/");K.length<2?K.push(z):K[1]=z,K.length===2&&K.push(""),K.join("/")!==s.pathname&&(c(K.join("/")),b(-1),j(-1),m(-1))},ae=z=>{y&&$(!1);const K=s.pathname.split("/");if(K.length===2&&K[1]!=="")K.push(z);else if(K.length>2)K[2]=z;else return;K.join("/")!==s.pathname&&(c(K.join("/")),b(-1),j(-1),m(-1))};return h.useEffect(()=>{const z=()=>{M(window.innerWidth)};return z(),window.addEventListener("resize",z),()=>{window.removeEventListener("resize",z)}},[]),e.jsxs(u,{sx:{display:"flex"},children:[y&&!v&&e.jsx(u,{sx:{position:"fixed",top:10,left:10,zIndex:1200,backgroundColor:"background.paper",borderRadius:"50%",boxShadow:2},children:e.jsx(Ne,{"data-testid":"sidebar-open-button",onClick:()=>$(!0),sx:{borderRadius:"50%",p:1},children:e.jsx(It,{})})}),e.jsx(jn,{open:y?v:!0,variant:y?"temporary":"persistent",onClose:y?()=>$(!1):void 0,sx:{width:y||i?H:q,flexShrink:0,"& .MuiDrawer-paper":{width:y||i?H:q,boxSizing:"border-box",overflowX:"hidden",transition:"width 0.3s ease-in-out"}},children:e.jsxs(u,{sx:{overflow:"hidden"},children:[e.jsxs(vn,{children:[e.jsx(Ae,{disablePadding:!0,children:e.jsxs(Ne,{"data-testid":"sidebar-collapse-button",onClick:ee,sx:{justifyContent:"center"},children:[e.jsx(ze,{sx:{minWidth:0},children:e.jsx(It,{})}),(!y&&i||y)&&e.jsx(Ie,{primary:""})]})}),e.jsx(Ae,{disablePadding:!0,children:e.jsx(fe,{title:!y&&!i?"Home":"",placement:"right",children:e.jsxs(Ne,{onClick:N,sx:{paddingLeft:!y&&!i?2.4:void 0,overflow:"hidden"},children:[e.jsx(ze,{children:e.jsx(yn,{})}),(!y&&i||y)&&e.jsx(Ie,{primary:"Home"})]})})}),!y&&!i&&e.jsx(Ae,{sx:{height:16}}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{primary:"Transcripts",sx:{ml:1,display:!y&&i||y?"block":"none"}}),$t(32).filter(z=>z.value===t).map(z=>e.jsx(Ae,{disablePadding:!0,children:e.jsx(fe,{title:!y&&!i?z.name:"",placement:"right",children:e.jsxs(Ne,{selected:t===z.value,onClick:()=>W(z.value),sx:{paddingLeft:!y&&!i?2:void 0,overflow:"hidden"},children:[e.jsx(ze,{children:z.icon}),(!y&&i||y)&&e.jsx(Ie,{primary:z.name})]})})},z.value)),!y&&!i&&e.jsx(Ae,{sx:{height:16}})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{primary:"Pages",sx:{mt:2,ml:1,display:!y&&i||y?"block":"none"}}),U.map(z=>e.jsx(Ae,{disablePadding:!0,children:e.jsx(fe,{title:!y&&!i?z.name:"",placement:"right",children:e.jsxs(Ne,{selected:window.location.pathname.split("/")[3]===z.value,onClick:()=>ae(z.value),sx:{paddingLeft:!y&&!i?2:void 0,overflow:"hidden"},"data-testid":z.testId,children:[e.jsx(ze,{children:z.icon}),(!y&&i||y)&&e.jsx(Ie,{primary:z.name})]})})},z.value))]}),E&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{primary:"Developer",sx:{mt:2,ml:1,display:!y&&i||y?"block":"none"}}),e.jsx(Ae,{disablePadding:!0,children:e.jsx(fe,{title:!y&&!i?"Dev Tools":"",placement:"right",children:e.jsxs(Ne,{"data-testid":"page-button-devTools",onClick:()=>D(!0),sx:{paddingLeft:!y&&!i?2:void 0,overflow:"hidden"},children:[e.jsx(ze,{children:e.jsx(wn,{})}),(!y&&i||y)&&e.jsx(Ie,{primary:"Dev Tools"})]})})})]}),e.jsx(Ae,{disablePadding:!0,sx:{mt:2},children:e.jsx(fe,{title:"https://github.com/duckautomata/live-transcript",placement:"right",children:e.jsxs(Ne,{onClick:()=>{window.open("https://github.com/duckautomata/live-transcript","_blank","noopener noreferrer")},sx:{paddingLeft:!y&&!i?2:void 0,overflow:"hidden"},children:[e.jsx(ze,{children:e.jsx(Cn,{})}),(!y&&i||y)&&e.jsx(Ie,{primary:"GitHub"})]})})}),e.jsx(Ae,{disablePadding:!0,children:e.jsx(fe,{title:!y&&!i?"Help":"",placement:"right",children:e.jsxs(Ne,{onClick:()=>O(!0),sx:{paddingLeft:!y&&!i?2:void 0,overflow:"hidden"},children:[e.jsx(ze,{children:e.jsx(Tn,{})}),(!y&&i||y)&&e.jsx(Ie,{primary:"Help"})]})})}),e.jsx(Ae,{disablePadding:!0,children:e.jsx(fe,{title:!y&&!i?"Settings":"",placement:"right",children:e.jsxs(Ne,{onClick:()=>a(!0),sx:{paddingLeft:!y&&!i?2:void 0,overflow:"hidden"},children:[e.jsx(ze,{children:e.jsx($n,{})}),(!y&&i||y)&&e.jsx(Ie,{primary:"Settings"})]})})})]}),e.jsx(Fi,{open:f,setOpen:a}),e.jsx(Ai,{open:k,setOpen:O}),e.jsx(Bi,{open:R,setOpen:D})]})}),e.jsxs(u,{component:"main",sx:{flexGrow:1,padding:1,width:y?"100%":`calc(97vw - ${i?H:q}px)`,transition:"width 0.3s ease-in-out, margin-left 0.3s ease-in-out"},children:[n,e.jsx(Li,{wsKey:t,offset:y?0:i?H:q,width:A})]})]})}const Qe=t=>new Date(t*1e3).toLocaleTimeString(),De=(t,n)=>{if(!n||!t||n<=0||t<=0)return"00:00:00";let s=t-n;const c=s<0;s=Math.abs(s);const i=Math.floor(s/3600),p=Math.floor(s%3600/60),b=s%60;let j="";return i===0?j=`${String(p).padStart(2,"0")}m${String(b).padStart(2,"0")}s`:j=`${String(i).padStart(2,"0")}h${String(p).padStart(2,"0")}m${String(b).padStart(2,"0")}s`,c?"-"+j:j},St=t=>{const n=new Date(t*1e3),s=n.getUTCHours().toString().padStart(2,"0"),c=n.getUTCMinutes().toString().padStart(2,"0"),i=n.getUTCSeconds().toString().padStart(2,"0");return`${s}:${c}:${i}`},Pi=({wsKey:t})=>{const n=l(g=>g.clipPopupOpen),s=l(g=>g.clipStartIndex),c=l(g=>g.clipEndIndex),i=l(g=>g.mediaType),p=l(g=>g.mediaBaseUrl),b=l(g=>g.transcript),j=l(g=>g.startTime),m=l(g=>g.activeId),v=l(g=>g.pastStreamViewing)||m,$=l(g=>g.setClipPopupOpen),k=l(g=>g.setClipStartIndex),O=l(g=>g.setClipEndIndex),[f,a]=h.useState("config"),[R,D]=h.useState(!1),[A,M]=h.useState(!1),[y,H]=h.useState(null),[q,U]=h.useState(""),[ee,N]=h.useState(""),[W,ae]=h.useState(""),[z,K]=h.useState(!1),[ce,me]=h.useState(""),ue=h.useRef(null),he=h.useRef(null),w=h.useRef(null),Q=h.useRef(null),ie=h.useRef(!1),[oe,J]=h.useState(!1),[V,P]=h.useState(!1),[Z,X]=h.useState({start:0,end:0}),[Y,de]=h.useState(0),ye=i==="video",je=h.useMemo(()=>b.find(g=>g.id===Math.min(s,c)),[b,s,c]),se=h.useMemo(()=>b.find(g=>g.id===Math.max(s,c)),[b,s,c]),we=async g=>{if(W===""){K(!0);return}me(""),D(!0);const T=Math.min(s,c),I=Math.max(s,c);try{const F=await fetch(`${Ue}/${t}/clip`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stream_id:v,start:T,end:I,type:W})});if(!F.ok)throw new Error(`Server returned ${F.status}`);const B=(await F.json()).clip_id;if(H(B),g){const _=vt(p,t,v,B,W,ee);window.open(_,"_blank"),L()}else a("preview")}catch(F){me(`Unable to create the clip: ${F.message}`)}finally{D(!1)}},ke=async()=>{if(!y)return;if(me(""),Z.start>.1||Z.end<Y-.1){M(!0);try{const T=await fetch(`${Ue}/${t}/trim`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stream_id:v,clip_id:y,file_format:W,start:Z.start,end:Z.end})});if(!T.ok)throw new Error(`Trim failed with status ${T.status}`);const F=(await T.json()).clip_id,S=vt(p,t,v,F,W,ee);window.open(S,"_blank"),L()}catch(T){me(`Unable to trim clip: ${T.message}`)}finally{M(!1)}}else{const T=vt(p,t,v,y,W,ee);window.open(T,"_blank"),L()}},Ce=()=>{Q.current&&(Q.current.clearRegions(),Q.current.addRegion({start:0,end:Y,color:"rgba(56, 212, 186, 0.4)",drag:!0,resize:!0}),X({start:0,end:Y}))},Le=g=>{const T=parseFloat(g.target.value);if(!(isNaN(T)||T<0)&&!(T>=Z.end)&&(X(I=>({...I,start:T})),Q.current)){const I=Q.current.getRegions()[0];I&&I.setOptions({start:T})}},Re=g=>{const T=parseFloat(g.target.value);if(!(isNaN(T)||T>Y)&&!(T<=Z.start)&&(X(I=>({...I,end:T})),Q.current)){const I=Q.current.getRegions()[0];I&&I.setOptions({end:T})}},L=()=>{w.current&&(w.current.destroy(),w.current=null),k(-1),O(-1),d()},d=()=>{N(""),ae(""),K(!1),O(-1),$(!1),a("config"),H(null),U(""),P(!1),me(""),M(!1)};h.useEffect(()=>{if(f==="preview"&&y&&ue.current){const g=ue.current;g.innerHTML="";const T=Bt(p,t,v,y,W);let I=T;const F={container:g,waveColor:"#4f4f4f",progressColor:"#38d4ba",height:100,barWidth:2,barGap:1,mediaControls:!0};W==="mp4"&&(I=Bt(p,t,v,y,"m4a")),W==="mp4"&&he.current&&(he.current.src=T),F.url=I;const S=In.create(F);if(W==="mp4"&&he.current){const _=he.current;let G=0;S.on("play",()=>_.play()),S.on("pause",()=>_.pause()),S.on("timeupdate",ge=>{if(S.isPlaying())Math.abs(_.currentTime-ge)>.2&&(_.currentTime=ge);else{const x=Date.now();x-G>150&&(_.currentTime=ge,G=x)}}),S.on("interaction",ge=>{S.isPlaying()||(_.currentTime=ge,G=Date.now())})}const B=S.registerPlugin(Rn.create());return Q.current=B,S.on("decode",()=>{const _=S.getDuration();de(_),B.addRegion({start:0,end:_,color:"rgba(56, 212, 186, 0.4)",drag:!0,resize:!0}),X({start:0,end:_}),P(!0)}),B.on("region-updated",_=>{X({start:_.start,end:_.end})}),B.on("region-clicked",(_,G)=>{G.stopPropagation(),ie.current=!1,J(!1),_.play()}),B.on("region-out",_=>{ie.current&&_.play()}),w.current=S,()=>{ie.current=!1,J(!1),S.destroy()}}},[f,y,t,W,v,p]),h.useEffect(()=>{const g=T=>{if(f!=="preview"||!V)return;const I=()=>Q.current?.getRegions()[0];if(T.code==="Space")if(T.preventDefault(),T.shiftKey){const F=I();F&&(ie.current=!0,J(!0),F.play())}else ie.current=!1,J(!1),w.current?.playPause();else if(T.code==="KeyA"){if(T.ctrlKey||T.metaKey)return;const F=I(),S=w.current?.getCurrentTime();F&&S!==void 0&&S<F.end&&(F.setOptions({start:S}),X({start:S,end:F.end}))}else if(T.code==="KeyD"){if(T.ctrlKey||T.metaKey)return;const F=I(),S=w.current?.getCurrentTime();F&&S!==void 0&&S>F.start&&(F.setOptions({end:S}),X({start:F.start,end:S}))}else if(T.code==="KeyR"){if(T.shiftKey)return;if(Q.current&&w.current){const F=w.current.getDuration();Q.current.clearRegions(),Q.current.addRegion({start:0,end:F,color:"rgba(56, 212, 186, 0.4)",drag:!0,resize:!0}),X({start:0,end:F})}}else if(T.code==="ArrowLeft")if(T.preventDefault(),T.altKey){const F=I();if(F){let B=F.start-.1,_=F.end-.1;B<0&&(B=0,_=F.end-F.start),F.start>0&&(F.setOptions({start:B,end:_}),X({start:B,end:_}))}}else w.current?.skip(-.1);else if(T.code==="ArrowRight")if(T.preventDefault(),T.altKey){const F=I();if(F){const B=w.current?.getDuration()||0;let _=F.start+.1,G=F.end+.1;G>B&&(G=B,_=B-(F.end-F.start)),F.end<B&&(F.setOptions({start:_,end:G}),X({start:_,end:G}))}}else w.current?.skip(.1)};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[f,V]);const C=h.useMemo(()=>{if(!je||!se)return"";const g=De(je.timestamp,j),T=De(se.timestamp,j);return`From ${g} to ${T}`},[je,se,j]);return e.jsxs(et,{open:n,onClose:L,maxWidth:"md",fullWidth:!0,children:[e.jsx(at,{children:"Clip Editor"}),e.jsxs(tt,{children:[f==="config"&&e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsxs(o,{variant:"body1",children:["Creating a clip containing ",1+Math.abs(c-s)," lines."]}),e.jsx(o,{variant:"body2",color:"textSecondary",children:C}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsx(re,{label:"Clip Name",value:ee,onChange:g=>N(g.target.value),sx:{flexGrow:1},autoFocus:!0}),e.jsxs(Ve,{error:z,sx:{minWidth:150},children:[e.jsx(nt,{id:"format-select-label",children:"File Format"}),e.jsxs(Je,{labelId:"format-select-label",value:W,label:"File Format",onChange:g=>{ae(g.target.value),K(!1)},children:[e.jsx(le,{value:"mp3",children:"MP3 (Audio)"}),e.jsx(le,{value:"m4a",children:"M4A (Audio)"}),e.jsx(le,{value:"mp4",disabled:!ye,children:"MP4 (Video)"})]}),z&&e.jsx(Mn,{children:"Please select a format."})]})]}),ce&&e.jsx(o,{variant:"body2",color:"error",sx:{mt:1,textAlign:"center"},children:ce})]}),f==="preview"&&e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsxs(o,{variant:"subtitle1",gutterBottom:!0,children:["Trim your clip",q&&e.jsxs(o,{component:"span",variant:"body2",color:"textSecondary",sx:{ml:1},children:["Current File: ",q,".",W]}),oe&&e.jsx(o,{component:"span",variant:"body2",sx:{ml:2,fontWeight:"bold",color:"primary.main"},children:"Looping, pause to stop"})]}),W==="mp4"&&e.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx("video",{ref:he,style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"4px"},controls:!1,muted:!0})}),e.jsxs(u,{sx:{width:"100%",minHeight:"100px",bgcolor:"background.paper",borderRadius:1,position:"relative"},children:[e.jsx("div",{ref:ue,style:{width:"100%",height:"100%",minHeight:"100px"}}),!V&&e.jsx(u,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:5},children:e.jsx(Ye,{size:30})})]}),e.jsx(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:"action.hover",p:1,borderRadius:1},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:{xs:2,sm:3},width:"100%",justifyContent:"center",flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(re,{label:"Start",type:"number",size:"small",value:Z.start,onChange:Le,inputProps:{step:.01,min:0,max:Z.end},sx:{width:100}}),e.jsx(re,{label:"End",type:"number",size:"small",value:Z.end,onChange:Re,inputProps:{step:.01,min:Z.start,max:Y},sx:{width:100}})]}),e.jsxs(o,{variant:"body2",sx:{minWidth:"120px",textAlign:"center"},children:["Duration: ",e.jsxs("strong",{children:[(Z.end-Z.start).toFixed(2),"s"]})]}),e.jsx(ne,{size:"small",onClick:Ce,color:"inherit",sx:{ml:{xs:0,sm:2}},startIcon:e.jsx(Jt,{}),children:"Reset Trim"})]})}),e.jsxs(o,{variant:"caption",sx:{display:"block",textAlign:"center",mt:.5,color:"text.secondary"},children:[e.jsx("strong",{children:"Keyboard Controls:"})," ",e.jsx(u,{component:"span",sx:{color:"primary.main",fontWeight:"bold"},children:"Space"})," ","(Play/Pause),"," ",e.jsx(u,{component:"span",sx:{color:"primary.main",fontWeight:"bold"},children:"Shift+Space"})," ","(Play Region),"," ",e.jsx(u,{component:"span",sx:{color:"primary.main",fontWeight:"bold"},children:"/"})," ","(Seek),"," ",e.jsx(u,{component:"span",sx:{color:"primary.main",fontWeight:"bold"},children:"Alt+/"})," ","(Move Selection),"," ",e.jsx(u,{component:"span",sx:{color:"primary.main",fontWeight:"bold"},children:"A/D"})," ","(Set Start/End),"," ",e.jsx(u,{component:"span",sx:{color:"primary.main",fontWeight:"bold"},children:"R"})," ","(Reset)"]}),ce&&e.jsx(o,{variant:"body2",color:"error",sx:{mt:1,textAlign:"center"},children:ce})]})]}),e.jsxs(rt,{sx:{justifyContent:"space-between",px:3,pb:2},children:[e.jsx(ne,{onClick:L,color:"inherit",children:"Cancel"}),f==="config"?e.jsxs(e.Fragment,{children:[e.jsx(ne,{onClick:()=>we(!0),color:"primary",disabled:R,startIcon:R&&e.jsx(Ye,{size:20}),children:R?"Processing...":"Direct Download"}),e.jsx(ne,{onClick:()=>we(!1),variant:"contained",disabled:R,startIcon:R&&e.jsx(Ye,{size:20}),children:R?"Processing...":"Trim Clip"})]}):e.jsx(ne,{onClick:ke,variant:"contained",color:"primary",disabled:!V||A,startIcon:A&&e.jsx(Ye,{size:20}),children:A?"Trimming...":"Download Clip"})]})]})},ct=t=>t!==""&&t!==null&&Number.isInteger(+t),Pt=t=>{if(!ct(t))throw Error("snowflake is not an int");if(Number(t)<4194304)throw Error("Snowflake is too small");const n=1420070400,s=BigInt(t)>>22n;if(s>Number.MAX_SAFE_INTEGER)throw Error("Number is outside the safe int range");return Number(s/BigInt(1e3))+n},Ot=(t,n,s)=>{if(!ct(t)||!ct(n)||!ct(s))throw Error("parameters need to be an int");return+n+ +s-+t},Nt=t=>{if(!ct(t))throw Error("offset need to be an int");return`!adjust ${+t>0?"-":""}${Math.abs(+t)}`},r=`(\\b|["'(\\[\\-_])`,Oi=[[new RegExp(`${r}(https?:\\/\\/)?(www\\.|t\\.|m\\.)?([a-zA-Z0-9-]+)\\.(com|io|ai|tv|be|cc|ly|co|net|org|us|ca|edu|gov|mil)`,"gi"),"$1$4's website"],[new RegExp(`${r}([a-zA-Z0-9-]+)\\.(com|io|ai|tv|be|cc|ly|co|net|org|us|ca|edu|gov|mil)`,"gi"),"$1$2. $3"],[new RegExp(`${r}nigg`,"gi"),"$1person"],[new RegExp("faggot","gi"),"person"],[new RegExp(`${r}fagg`,"gi"),"$1person"],[new RegExp(`${r}fag`,"gi"),"$1person"],[new RegExp(`${r}dyke`,"gi"),"$1person"],[new RegExp(`${r}retard`,"gi"),"$1person"],[new RegExp(`${r}tranny`,"gi"),"$1person"],[new RegExp(`${r}chink`,"gi"),"$1person"],[new RegExp(`${r}kike`,"gi"),"$1person"],[new RegExp(`${r}jew`,"gi"),"$1person"],[new RegExp(`${r}gypsy`,"gi"),"$1person"],[new RegExp(`${r}mongol`,"gi"),"$1person"],[new RegExp("white boy","gi"),"boy"],[new RegExp(`${r}cult`,"gi"),"$1group"],[new RegExp(`${r}trap${r}`,"gi"),"$1ambush$2"],[new RegExp(`${r}gay${r}`,"gi"),"$1loving$2"],[new RegExp(`${r}twink${r}`,"gi"),"$1boy$2"],[new RegExp(`${r}lesbian${r}`,"gi"),"$1girl$2"],[new RegExp(`${r}homosexual${r}`,"gi"),"$1loving$2"],[new RegExp(`${r}bisexual${r}`,"gi"),"$1loving$2"],[new RegExp(`${r}trans${r}`,"gi"),"$1loving$2"],[new RegExp(`${r}queer${r}`,"gi"),"$1loving$2"],[new RegExp("kill yourself","gi"),"go away"],[new RegExp(`${r}suicide`,"gi"),"$1go to sleep"],[new RegExp(`${r}stays alive`,"gi"),"$1keep going"],[new RegExp(`${r}kill`,"gi"),"$1take out"],[new RegExp(`${r}murder`,"gi"),"$1attack"],[new RegExp(`${r}predator`,"gi"),"$1hunter"],[new RegExp(`${r}(r)a(pe|pist)`,"gi"),"$1not good action"],[new RegExp(`${r}shoot`,"gi"),"$1pew-pew"],[new RegExp(`${r}stab`,"gi"),"$1perform surgery"],[new RegExp(`${r}torture`,"gi"),"$1horror"],[new RegExp(`${r}bomb`,"gi"),"$1tnt"],[new RegExp(`${r}grenade`,"gi"),"$1hand-tnt"],[new RegExp(`${r}missile`,"gi"),"$1rocket"],[new RegExp(`${r}gun`,"gi"),"$1pew-pew"],[new RegExp(`${r}terrorist`,"gi"),"$1demolition person"],[new RegExp(`${r}ntr`,"gi"),"$1cheating"],[new RegExp(`${r}dick`,"gi"),"$1thing"],[new RegExp(`${r}cock`,"gi"),"$1hot dog"],[new RegExp(`${r}penis`,"gi"),"$1hot dog"],[new RegExp(`${r}cuck`,"gi"),"$1person"],[new RegExp(`${r}vagina`,"gi"),"$1body part"],[new RegExp(`${r}clit`,"gi"),"$1body part"],[new RegExp(`${r}cunt`,"gi"),"$1mean person"],[new RegExp(`${r}anal`,"gi"),"$1thorough"],[new RegExp(`${r}anus`,"gi"),"$1body part"],[new RegExp(`${r}booty`,"gi"),"$1rear"],[new RegExp(`${r}boner`,"gi"),"$1bone"],[new RegExp(`${r}dildo`,"gi"),"$1toy"],[new RegExp(`${r}sexy`,"gi"),"$1good looking"],[new RegExp(`${r}sex`,"gi"),"$1procreation"],[new RegExp(`${r}porn`,"gi"),"$1grown up movies"],[new RegExp("gooner","gi"),"degen"],[new RegExp("g\\*oner","gi"),"degen"],[new RegExp("go\\*ner","gi"),"degen"],[new RegExp("g\\*\\*ner","gi"),"degen"],[new RegExp("goo\\*er","gi"),"degen"],[new RegExp(`${r}goon`,"gi"),"$1go-on"],[new RegExp(`${r}coomer`,"gi"),"$1degen"],[new RegExp(`${r}coom`,"gi"),"$1co-om"],[new RegExp(`${r}edging`,"gi"),"$1close"],[new RegExp(`${r}mpreg`,"gi"),"$1birth"],[new RegExp("hentai","gi"),"grown up anime"],[new RegExp(`${r}loli`,"gi"),"$1little"],[new RegExp(`${r}shota`,"gi"),"$1little"],[new RegExp(`${r}pe(do|dophile)`,"gi"),"$1bad"],[new RegExp(`${r}groomer`,"gi"),"$1cleaning"],[new RegExp(`${r}breed`,"gi"),"$1act"],[new RegExp(`${r}bukkake`,"gi"),"$1paint"],[new RegExp(`${r}masturbate`,"gi"),"$1play"],[new RegExp(`${r}orgasm`,"gi"),"$1finish"],[new RegExp(`${r}incest`,"gi"),"$1family"],[new RegExp(`${r}waifu`,"gi"),"$1wife"],[new RegExp(`${r}ball`,"gi"),"$1round object"],[new RegExp(`${r}sperm`,"gi"),"$1DNA"],[new RegExp(`${r}cum`,"gi"),"$1DNA"],[new RegExp(`${r}(com)m(ing)`,"gi"),"$1$2$3"],[new RegExp(`${r}nipple`,"gi"),"$1chest"],[new RegExp("(pu)s(sy|sies)","gi"),"chicken"],[new RegExp(`${r}ti(ts|ty|tties)`,"gi"),"$1chest"],[new RegExp(`${r}cleavage`,"gi"),"$1chest"],[new RegExp(`${r}boobs`,"gi"),"$1chests"],[new RegExp(`${r}boob`,"gi"),"$1chest"],[new RegExp(`${r}butt`,"gi"),"$1rear"],[new RegExp(`${r}thigh`,"gi"),"$1leg"],[new RegExp("fisting","gi"),"punching"],[new RegExp(`${r}fist`,"gi"),"$1hand"],[new RegExp(`${r}half-naked`,"gi"),"$1almost dressed"],[new RegExp(`${r}naked`,"gi"),"$1non dressed"],[new RegExp(`${r}nude`,"gi"),"$1non dressed"],[new RegExp(`${r}freaky`,"gi"),"$1wild"],[new RegExp(`${r}freak`,"gi"),"$1wild"],[new RegExp(`${r}pee`,"gi"),"$1leak"],[new RegExp(`${r}simp`,"gi"),"$1fawn"],[new RegExp(`${r}throb`,"gi"),"$1boop"],[new RegExp(`${r}condom`,"gi"),"$1protection"],[new RegExp(`${r}strip`,"gi"),"$1layer"],[new RegExp(`${r}bitch`,"gi"),"$1mean person"],[new RegExp(`${r}slut`,"gi"),"$1revolving door"],[new RegExp(`${r}panty`,"gi"),"$1undergarment"],[new RegExp(`${r}panties`,"gi"),"$1undergarment"],[new RegExp(`${r}mating`,"gi"),"$1reproduction"],[new RegExp(`${r}(wh)o(re|ring)`,"gi"),"$1mean person"],[new RegExp(`${r}(g)a(ngb)a(ng)`,"gi"),"$1group party"],[new RegExp(`(${r}|[^0-9])18\\+`,"gi"),"$118 up"],[new RegExp("(f)uck(ing)","gi"),"$1-$2"],[new RegExp("(f)\\*ck(ing)","gi"),"$1-$2"],[new RegExp("(f)u\\*k(ing)","gi"),"$1-$2"],[new RegExp("(f)uc\\*(ing)","gi"),"$1-$2"],[new RegExp("(f)\\*\\*k(ing)","gi"),"$1-$2"],[new RegExp(`${r}fuck`,"gi"),"$1frick"],[new RegExp(`${r}f\\*ck`,"gi"),"$1frick"],[new RegExp(`${r}fu\\*k`,"gi"),"$1frick"],[new RegExp(`${r}f\\*\\*k`,"gi"),"$1frick"],[new RegExp(`${r}shit`,"gi"),"$1rot"],[new RegExp(`${r}(a)ss(hole|hat)`,"gi"),"$1mean person"],[new RegExp(`${r}([a-zA-Z]*)-ass${r}`,"gi"),"$1$2$3"],[new RegExp(`${r}ass${r}`,"gi"),"$1rear$2"],[new RegExp(`${r}bastard`,"gi"),"$1rat"],[new RegExp(`${r}damn`,"gi"),"$1darn"],[new RegExp(`${r}crap`,"gi"),"$1nonsense"],[new RegExp(`${r}piss`,"gi"),"$1leak"],[new RegExp(`${r}douche`,"gi"),"$1rascal"],[new RegExp(`${r}jackass`,"gi"),"$1donkey"],[new RegExp(`${r}dumbass`,"gi"),"$1birdbrain"],[new RegExp(`${r}stupid`,"gi"),"$1unsmart"],[new RegExp(`${r}idiot`,"gi"),"$1fool"],[new RegExp(`${r}loser`,"gi"),"$1nonwinner"],[new RegExp(`${r}racist`,"gi"),"$1narrow-minded"],[new RegExp(`${r}pervert`,"gi"),"$1degen"],[new RegExp(`${r}hitler`,"gi"),"$1person"],[new RegExp(`${r}nazi`,"gi"),"$1person"],[new RegExp(`${r}crypto`,"gi"),"$1digital"],[new RegExp(`${r}bitcoin`,"gi"),"$1digital"],[new RegExp(`${r}whatsapp`,"gi"),"$1social media"],[new RegExp(`${r}telegram`,"gi"),"$1social media"],[new RegExp(`${r}*#(\\w*[a-zA-Z]+\\w*)`,"gi"),"$1hashtag-$2"],[new RegExp(`${r}(mess)a(ge|ging)`,"gi"),"$1chat"],[new RegExp(`${r}comment`,"gi"),"$1chat"],[new RegExp(`${r}(tw)i(tter|tch)`,"gi"),"$1social media"],[new RegExp(`${r}tiktok`,"gi"),"$1social media"],[new RegExp(`${r}facebook`,"gi"),"$1social media"],[new RegExp(`${r}insta`,"gi"),"$1social media"],[new RegExp(`${r}discord`,"gi"),"$1social media"],[new RegExp(`${r}covid`,"gi"),"$1flu"],[new RegExp(`${r}drug(s)?`,"gi"),"$1medicine"],[new RegExp(`${r}weed`,"gi"),"$1medicine"],[new RegExp(`${r}cocaine`,"gi"),"$1medicine"],[new RegExp(`${r}heroin`,"gi"),"$1medicine"],[new RegExp(`${r}methamphetamine`,"gi"),"$1medicine"],[new RegExp(`${r}amphetamine`,"gi"),"$1medicine"],[new RegExp(`${r}ecstasy`,"gi"),"$1medicine"],[new RegExp(`${r}MDMA`,"gi"),"$1medicine"],[new RegExp(`${r}pill(s)?`,"gi"),"$1medicine"],[new RegExp(`${r}acid`,"gi"),"$1medicine"],[new RegExp(`${r}ammo`,"gi"),"$1rounds"],[new RegExp(`${r}bullet(s)?`,"gi"),"$1rounds"],[new RegExp(`${r}casino`,"gi"),"$1bet"],[new RegExp(`${r}slot(s)?`,"gi"),"$1bet"],[new RegExp(`${r}roulette`,"gi"),"$1bet"],[new RegExp(`${r}poker`,"gi"),"$1bet"],[new RegExp(`${r}baccarat`,"gi"),"$1bet"],[new RegExp(`${r}blackjack`,"gi"),"$1bet"],[new RegExp(`${r}gambl(e|ing)`,"gi"),"$1bet"],[new RegExp(`${r}mom${r}`,"gi"),"$1female caregiver$2"],[new RegExp(`${r}mother${r}`,"gi"),"$1female caregiver$2"],[new RegExp(`${r}red${r}`,"gi"),"$1crimson$2"],[new RegExp(`${r}snuffy`,"gi"),"$1Snum"],[new RegExp(`${r}snuffies`,"gi"),"$1Snum's"],[new RegExp(`${r}snuffles`,"gi"),"$1Snum's"],[new RegExp(`${r}snuff`,"gi"),"$1extinguish"],[new RegExp(`${r}smut${r}`,"gi"),"$1messy$2"],[new RegExp(`${r}sloppy`,"gi"),"$1messy"],[new RegExp(`${r}sloppies`,"gi"),"$1messy"],[/\\/g,""],[/^\s*\[([\dhms]+)\] /i,"$1 "],[/^\s*(\d )/,"00:0$1"],[/^\s*(\d+ )/,"00:$1"],[/^\s*(\d\d)s /i,"00:$1 "],[/^\s*(\d\d)m(\d\d)s /i,"$1:$2 "],[/^\s*(\d\d)h(\d\d)m(\d\d)s /i,"$1:$2:$3 "],[/^\s*00:00:00 /,"00:00:01 "],[/^\s*00:00 /,"00:01 "],[/^\s*[0-9:]+ (!adjust|!t)\b.*/i,""]],Ni=[[/:memboo/gi,":_"],[/~\d+:/gi,":"]],wt=t=>(Oi.forEach(n=>{t=t.replace(n[0],n[1])}),t),Wi=t=>(Ni.forEach(n=>{t=t.replace(n[0],n[1])}),t),zi=(t,n)=>{if(!t||t.trim().length===0)return t??"";const s=/[\d:]+\s+HBD\s*.*/i,c=/\s*HBD\s*/i,i=`*${n}*`,p=t.trim().split(`
`),b=p.filter(m=>s.test(m)).map(m=>m.replace(c," ").trim()).join(`
`),j=p.filter(m=>!s.test(m)).join(`
`);return j.trim().length===0&&b.trim().length===0?"":j.trim().length===0?`${i}
${b}`:b.trim().length===0?t:`${j}

${i}
${b}`},_i=(t,n)=>{const s=$=>typeof $!="string"?"":$.toLowerCase().replace(/\s/g,""),c=s(t),i=s(n),p=c.length,b=i.length;if(c===""&&i==="")return 100;if(c===""||i==="")return 0;const j=Array(p+1).fill(null).map(()=>Array(b+1).fill(0));for(let $=1;$<=p;$++)for(let k=1;k<=b;k++)c[$-1]===i[k-1]?j[$][k]=j[$-1][k-1]+1:j[$][k]=Math.max(j[$-1][k],j[$][k-1]);const m=j[p][b],E=Math.max(p,b);if(E===0)return 100;const v=m/E*100;return Math.floor(v)},ve=t=>{if(!t)return 0;const n=t.trim().split(":").map(Number);return n.length===3?n[0]*3600+n[1]*60+n[2]:n.length===2?n[0]*60+n[1]:n[0]||0},nn=t=>{t<0&&(t=0);const n=Math.floor(t/3600),s=Math.floor(t%3600/60),c=Math.floor(t%60);return n>0?`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`:`${s.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`},ht=t=>{const n=[],s=[],c=[],i=[];t.forEach(m=>{m.subtype==="collection"?m.type==="header"?n.push(m):s.push(m):m.subtype==="hbd"?c.push(m):i.push(m)});const p=[];n.forEach(m=>{const E=s.filter(v=>v.parentName===m.name);E.sort((v,$)=>ve(v.timestamp)-ve($.timestamp)),E.length>0&&(m.timestamp=E[0].timestamp),p.push(m),p.push(...E)}),i.sort((m,E)=>{const v=ve(m.timestamp),$=ve(E.timestamp);return v-$});let b=null;const j=i.map(m=>m.type==="header"&&m.subtype==="chapter"?(b=m.name,m):m.type==="tag"?{...m,parentName:b}:m);return[...p,...j,...c]};let Vi=0;const qe=t=>`${t}-${Date.now()}-${Vi++}`,Wt=(t,n,s)=>{const i=zi(t,s).split(`
`).filter(a=>a.trim().length>0),p=[],b={},j=/([\d:]+)\s+(.*?)\s*::\s*(.*)/i,m=/([\d:]+)\s+\[(.*?)\]\s*(.*)/i,E=new RegExp(`\\*(${s.replace("!","\\!")})\\*`,"i"),v=new Map,$=[],k=a=>{if(!a)return{text:"",wasCensored:!1};let R=wt(a);const D=R!==a;return n==="mint"&&(R=Wi(R)),{text:R,wasCensored:D}};i.forEach(a=>{const{text:R}=k(a),D=R.match(j),A=a.match(j);if(D){const M=D[1],y=D[2],H=D[3],q=A[2],U=A[3],ee=y,N=[...v.keys()].find(W=>_i(W,ee)>=90)||ee;v.has(N)||v.set(N,{items:[],wasHeaderCensored:y!==q}),v.get(N).items.push({timestamp:M,text:H,originalText:U,name:N,originalName:q,wasCensored:H!==U})}else $.push(a)}),[...v.keys()].forEach((a,R)=>{b[a]={isEnabled:!0,type:"collection",order:R};const D=v.get(a),A=D.items,M=A.length>0?A[0].timestamp:"00:00",y=A.length>0?A[0].originalName:a;p.push({id:qe("col-header"),type:"header",subtype:"collection",name:a,originalName:y,timestamp:M,isEnabled:!0,wasCensored:D.wasHeaderCensored}),A.forEach(H=>{p.push({id:qe("tag"),type:"tag",subtype:"collection",parentName:a,timestamp:H.timestamp,text:H.text,originalText:H.originalText,isEnabled:!0,isEditing:!1,wasCensored:H.wasCensored})})});let O=!1,f=null;return $.filter(a=>wt(a).trim().length>0).forEach(a=>{if(E.test(a)||a.includes(`*${s}*`)){O=!0,f=null,b[s]||(b[s]={isEnabled:!0,type:"hbd"}),p.push({id:qe("hbd-header"),type:"header",subtype:"hbd",name:s,originalName:s,isEnabled:!0});return}const{text:R}=k(a),D=R.match(m),A=a.match(m);if(D){const M=D[1],y=D[2],H=D[3],q=A[2],U=A[3];f=y,b[f]||(b[f]={isEnabled:!0,type:"chapter"}),p.push({id:qe("chap-header"),type:"header",subtype:"chapter",name:f,originalName:f,timestamp:M,isEnabled:!0,wasCensored:y!==q}),H&&H.trim().length>0&&p.push({id:qe("tag"),type:"tag",subtype:"chapter",parentName:f,timestamp:M,text:H,originalText:U,isEnabled:!0,isEditing:!1,wasCensored:H!==U})}else{const M=R.match(/^([\d:]+)\s+(.*)/),y=a.match(/^([\d:]+)\s+(.*)/);if(M){const H=M[1],q=M[2],U=y[2];p.push({id:qe("tag"),type:"tag",subtype:O?"hbd":"normal",parentName:O?s:f,timestamp:H,text:q,originalText:U,isEnabled:!0,isEditing:!1,wasCensored:q!==U})}else{const H=k(a);p.push({id:qe("tag"),type:"tag",subtype:O?"hbd":"normal",timestamp:"",text:H.text,originalText:a,isEnabled:!0,isEditing:!1,wasCensored:H.wasCensored})}}}),{newRows:p,newControls:b}},sn=(t,n,s,c,i)=>{const p={...n};let b=[],m=Object.values(n).reduce((a,R)=>R.type==="collection"?Math.max(a,R.order||0):a,-1)+1,E=[...t];const v=new Set,$=new Set;s.forEach(a=>{if(a.type!=="header")return;const R=E.find(D=>D.type==="header"&&D.subtype===a.subtype&&(D.name===a.name||D.originalName&&D.originalName===a.name)&&!$.has(D.id));if(R)$.add(R.id),R.timestamp!==a.timestamp&&(R.timestamp=a.timestamp);else{let D=null;if(a.subtype==="chapter"&&(D=E.find(A=>A.type==="header"&&A.subtype==="chapter"&&A.timestamp===a.timestamp&&!$.has(A.id))),D){$.add(D.id);const A=D.name,M=a.name;D.name=M,D.originalName=M,p[A]?(p[M]={...p[A]},delete p[A]):c[M]&&(p[M]=c[M])}else b.find(M=>M.type==="header"&&M.name===a.name&&M.subtype===a.subtype)||(b.push(a),c[a.name]&&(p[a.name]={...c[a.name],order:m++}))}}),s.forEach(a=>{if(a.type!=="tag")return;const R=E.find(M=>{const y=M.text===a.text||M.originalText&&M.originalText===a.text,H=M.timestamp===a.timestamp;return M.type==="tag"&&y&&H&&!v.has(M.id)});if(R){v.add(R.id),a.parentName&&R.parentName!==a.parentName&&(R.parentName=a.parentName);return}const D=E.find(M=>M.type==="tag"&&M.timestamp===a.timestamp&&!v.has(M.id));if(D){v.add(D.id),D.text=a.text,D.originalText=a.text,a.parentName&&D.parentName!==a.parentName&&(D.parentName=a.parentName);return}const A=E.find(M=>{const y=M.text===a.text||M.originalText&&M.originalText===a.text;return M.type==="tag"&&y&&!v.has(M.id)});if(A){v.add(A.id),A.timestamp=a.timestamp,a.parentName&&A.parentName!==a.parentName&&(A.parentName=a.parentName);return}b.push(a)}),E=[...E,...b];const k={};E.forEach(a=>{a.type==="tag"&&a.parentName&&(k[a.parentName]=(k[a.parentName]||0)+1)}),E=E.filter(a=>a.type==="header"?a.subtype==="hbd"||a.subtype==="chapter"?!0:(k[a.name]||0)>0:!0);const O=new Set(E.filter(a=>a.type==="header").map(a=>a.name));Object.keys(p).forEach(a=>{!O.has(a)&&a!==i&&delete p[a]});const f=Object.keys(p).filter(a=>p[a].type==="collection");return f.sort((a,R)=>(p[a].order||0)-(p[R].order||0)),f.forEach((a,R)=>{p[a].order=R}),E=ht(E),{rows:E,controls:p}},Ui=({wsKey:t})=>{const n=l(V=>V.tagPopupOpen),s=l(V=>V.setTagPopupOpen),c=l(V=>V.tagPopupTimestamp),i=l(V=>V.tagPopupText),p=l(V=>V.defaultOffset),b=l(V=>V.setDefaultOffset),j=l(V=>V.startTime),m=l(V=>V.formattedRows),E=l(V=>V.setFormattedRows),v=l(V=>V.controls),$=l(V=>V.setControls),[k,O]=h.useState(0),[f,a]=h.useState(p),[R,D]=h.useState(""),[A,M]=h.useState(null),y=De(c,j),[H,q]=h.useState(""),[U,ee]=h.useState("normal"),[N,W]=h.useState(""),[ae,z]=h.useState(""),K=V=>{D(V.target.value);let P=null,Z=null,X=null;try{P=Pt(V.target.value),Z=Ot(c,P,f),X=Nt(Z)}catch{X=null}M(X)},ce=V=>{a(V.target.value);let P=null,Z=null,X=null;try{P=Pt(R),Z=Ot(c,P,V.target.value),X=Nt(Z)}catch{X=null}M(X)},me=()=>{A!==null&&navigator.clipboard.writeText(A.toString())},ue=()=>{s(!1),b(f),D(""),M(null),q(""),W(""),z(""),ee("normal"),O(0)},he=()=>{if(U!=="chapter"&&!H.trim()||U==="chapter"&&(!N.trim()||ie.includes(N.trim())))return;const V=Math.max(0,c-j),P=nn(V),Z=t==="doki"?"Dragoon Birthdays":"Birthdays!",X=[],Y={},de=se=>`${se}-${Date.now()}-creator`;if(U==="chapter"){const se=N.trim();X.push({id:de("chap-header"),type:"header",subtype:"chapter",name:se,originalName:se,timestamp:P,isEnabled:!0}),Y[se]={isEnabled:!0,type:"chapter"},H.trim()&&X.push({id:de("tag"),type:"tag",subtype:"chapter",parentName:se,timestamp:P,text:H,originalText:H,isEnabled:!0,isEditing:!1})}else if(U==="collection"){const se=ae.trim()||"Group";X.push({id:de("col-header"),type:"header",subtype:"collection",name:se,originalName:se,timestamp:P,isEnabled:!0}),Y[se]={isEnabled:!0,type:"collection",order:999},X.push({id:de("tag"),type:"tag",subtype:"collection",parentName:se,timestamp:P,text:H,originalText:H,isEnabled:!0,isEditing:!1})}else X.push({id:de("tag"),type:"tag",subtype:"normal",timestamp:P,text:H,originalText:H,isEnabled:!0,isEditing:!1,isError:!1});const{rows:ye,controls:je}=sn(m,v,X,Y,Z);E(ye),$(je),ue()},w=m&&m.length>0,Q=Object.keys(v).filter(V=>v[V].type==="collection"),ie=m.filter(V=>V.type==="header"&&V.subtype==="chapter").map(V=>V.name),oe=!ie.includes(N.trim()),J=U==="chapter"?!N.trim()||!oe:!H.trim();return e.jsxs(et,{open:n,onClose:ue,maxWidth:"sm",fullWidth:!0,children:[w?e.jsx(u,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ct,{value:k,onChange:(V,P)=>O(P),variant:"fullWidth",children:[e.jsx(Ze,{label:"Check Offset"}),e.jsx(Ze,{label:"Create Tag"})]})}):e.jsx(at,{children:"Tag Offset Calculator"}),e.jsxs(tt,{sx:{pt:2},children:[e.jsx(Te,{elevation:6,sx:{padding:1.3,mb:2},children:e.jsxs(o,{children:["[",y,"] ",i]})}),k===0&&e.jsxs(e.Fragment,{children:[!w&&e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Offset Calculator"}),e.jsx(o,{paddingTop:1,children:"Enter the Message ID of the tag you want to offset."}),e.jsx(re,{label:"Message ID",type:"text",value:R,onChange:K,fullWidth:!0,margin:"normal",size:"small"}),e.jsx(o,{children:"Enter the taggerbot default offset."}),e.jsx(re,{label:"Default Offset",type:"text",value:f,onChange:ce,fullWidth:!0,margin:"normal",size:"small"}),A!==null&&e.jsx(o,{variant:"body1",marginTop:"16px",sx:{bgcolor:"action.hover",p:1,borderRadius:1},children:e.jsx("span",{style:{fontFamily:"monospace"},children:A})})]}),k===1&&e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsx(re,{label:U==="chapter"?"Tag Text (Optional)":"Tag Text",value:H,onChange:V=>q(V.target.value),fullWidth:!0,autoFocus:!0}),e.jsxs(Ve,{children:[e.jsx(An,{children:"Tag Type"}),e.jsxs(Fn,{row:!0,value:U,onChange:V=>ee(V.target.value),children:[e.jsx(Xe,{value:"normal",control:e.jsx(xt,{}),label:"Normal"}),e.jsx(Xe,{value:"chapter",control:e.jsx(xt,{}),label:"Chapter"}),e.jsx(Xe,{value:"collection",control:e.jsx(xt,{}),label:"Group"})]})]}),U==="chapter"&&e.jsx(Rt,{freeSolo:!0,options:ie,value:N,onInputChange:(V,P)=>W(P),renderInput:V=>e.jsx(re,{...V,label:"Chapter Name",error:!oe&&!!N,helperText:!oe&&N?"Chapter name already exists":""})}),U==="collection"&&e.jsx(Rt,{freeSolo:!0,options:Q,value:ae,onInputChange:(V,P)=>z(P),renderInput:V=>e.jsx(re,{...V,label:"Group Name"})})]})]}),e.jsx(rt,{sx:{justifyContent:"space-between",px:3,pb:2},children:k===0?e.jsxs(e.Fragment,{children:[e.jsx(ne,{onClick:me,color:"primary",disabled:A===null,children:"Copy Command"}),e.jsx(ne,{onClick:ue,color:"primary",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{onClick:ue,color:"inherit",children:"Cancel"}),e.jsx(ne,{onClick:he,variant:"contained",color:"primary",disabled:J,children:"Create Tag"})]})})]})},Gi=(t=300*1e3)=>{const[n,s]=h.useState(!1),c=async()=>{try{const i=await fetch("/live-transcript/version.json",{cache:"no-store"});if(!i.ok)return;const p=await i.json();p.buildTime>1768943509848&&(console.log("Update available!",p.buildTime,1768943509848),s(!0))}catch(i){console.error("Failed to check for updates:",i)}};return h.useEffect(()=>{c();const i=setInterval(c,t);return()=>clearInterval(i)},[t]),{updateAvailable:n}},qi=()=>{const{updateAvailable:t}=Gi(),n=Tt(),[s,c]=h.useState(!1),i=()=>{c(!0),n("/",{replace:!0}),setTimeout(()=>{window.location.reload(!0)},100)};return e.jsx(Dn,{open:t,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{width:"90%",maxWidth:500,top:{xs:"12px !important",sm:"24px !important"},left:"50% !important",transform:"translateX(-50%) !important"},children:e.jsxs(Yt,{severity:"info",variant:"filled",icon:!1,sx:{alignItems:"center",width:"100%",backgroundColor:"#17786E",backdropFilter:"blur(8px)",color:"#FFFFFF",fontWeight:500,boxShadow:"0 4px 20px rgba(0,0,0,0.4)",borderRadius:"12px",border:"1px solid rgba(255, 255, 255, 0.2)"},action:e.jsx(ne,{variant:"contained",size:"small",disabled:s,startIcon:s?e.jsx(Ye,{size:20,color:"inherit"}):e.jsx(Bn,{}),onClick:i,sx:{backgroundColor:"#FFFFFF",color:"black",borderRadius:"8px",textTransform:"none",fontWeight:"bold",px:2,whiteSpace:"nowrap",boxShadow:"0 2px 10px rgba(0,0,0,0.3)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"}},children:s?"Updating...":"Update"}),children:[e.jsx(Ln,{children:"Update Available"}),"Refresh the page or click the update button to update the website."]})})};function Ji(){return e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",height:"50vh"},children:[e.jsx(Hn,{color:"error",sx:{fontSize:60,mb:2}}),e.jsx(o,{variant:"h5",component:"h2",sx:{mb:1},children:"Live Transcript is currently down for maintenance."}),e.jsx(o,{color:"text.secondary",children:window.maintenanceText1}),e.jsx(o,{color:"text.secondary",children:window.maintenanceText2}),e.jsx("br",{}),e.jsxs(o,{color:"text.secondary",children:["If you want to use the tag fixer, you can find it here:"," ",e.jsx(Pn,{to:"/tagFixer",children:"Click to go to tag fixer"})]})]})}const an=h.memo(({row:t,isEditing:n,startEditing:s,saveEdit:c,cancelEdit:i,toggleRowEnabled:p,extraMarginTop:b,densityStyles:j,theme:m,highlightColor:E,isHighlightedRow:v,headerOpacity:$,headerDecoration:k,registerRef:O,onMouseEnter:f,onMouseLeave:a,isHighlightedParent:R})=>{const[D,A]=h.useState(""),[M,y]=h.useState("");h.useEffect(()=>{n&&(A(t.type==="header"?t.name:t.text),y(t.timestamp||""))},[n,t]);const H=()=>{c(t.id,D,M)},q=N=>{N.key==="Enter"&&H(),N.key==="Escape"&&i()};if(t.type==="header"){const N=t.subtype==="chapter";return e.jsxs(u,{ref:W=>O(t.id,W),sx:{py:1,paddingBottom:0,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:N?Ke[500]:m.palette.primary.main,borderBottom:n?`1px solid ${st[500]}`:"none",opacity:$,textDecoration:k,bgcolor:v?"action.selected":R?"action.hover":"transparent",transition:"background-color 0.3s ease"},children:[e.jsx(u,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:n?e.jsxs(e.Fragment,{children:[N&&e.jsx(re,{variant:"standard",value:M,onChange:W=>y(W.target.value),placeholder:"00:00",sx:{width:"60px",mr:1},inputProps:{style:{textAlign:"right",fontWeight:"bold",color:"inherit"}},onKeyDown:q}),e.jsx(re,{variant:"standard",value:D,onChange:W=>A(W.target.value),autoFocus:!0,fullWidth:!0,onKeyDown:q,inputProps:{style:{textAlign:"center",fontWeight:"bold",color:"inherit"}}})]}):e.jsx(fe,{title:t.originalName,children:e.jsxs(o,{sx:{fontWeight:"bold",textDecoration:k},children:[N&&t.timestamp&&e.jsx("span",{style:{marginRight:"8px",opacity:.8},children:t.timestamp}),"*",t.name,"*"]})})}),e.jsx($e,{size:"small",onClick:()=>n?H():s(t),sx:{color:n?"success.main":st[500],ml:1},children:n?e.jsx(yt,{fontSize:"small"}):e.jsx(Mt,{fontSize:"small"})})]},t.id)}const U=t.isEnabled?1:.5,ee=t.isEnabled?"none":"line-through";return e.jsxs(u,{sx:{display:"flex",alignItems:"center",margin:"0 0 0 0",marginTop:b,padding:"0 0 0 0",...j,opacity:n?1:U,bgcolor:n?"action.selected":E||"transparent",border:n?`0px solid ${st[500]}`:"0px solid transparent","&:hover":{bgcolor:n?"action.selected":"action.hover"}},onMouseEnter:f,onMouseLeave:a,children:[e.jsx(pt,{checked:t.isEnabled,onChange:()=>p(t.id),size:"small",sx:{color:"primary.main",p:.5}}),n?e.jsx(re,{variant:"standard",value:M,onChange:N=>y(N.target.value),sx:{minWidth:"50px",width:"60px",mx:1},inputProps:{style:{fontFamily:"monospace"}},onKeyDown:q}):e.jsx(o,{variant:"body2",sx:{fontFamily:"monospace",mx:1,minWidth:"50px",color:m.palette.timestamp.main,textDecoration:ee,whiteSpace:"nowrap",flexShrink:0},children:t.timestamp}),n?e.jsx(re,{fullWidth:!0,multiline:!0,variant:"standard",value:D,onChange:N=>A(N.target.value),autoFocus:!0,onKeyDown:N=>{N.key==="Enter"&&(N.preventDefault(),H()),N.key==="Escape"&&i()},sx:{flexGrow:1}}):e.jsx(fe,{title:E?t.originalText:void 0,children:e.jsx(o,{variant:"body1",sx:{fontFamily:"monospace",flexGrow:1,textDecoration:ee,textAlign:"left",wordBreak:"break-word",minWidth:0},children:t.text})}),e.jsx($e,{size:"small",onClick:()=>n?H():s(t),sx:{color:n?"success.main":st[500]},children:n?e.jsx(yt,{fontSize:"small"}):e.jsx(Mt,{fontSize:"small"})})]},t.id)});an.displayName="TagRow";const zt=({wsKey:t})=>{const n=mt(),s=Se(n.breakpoints.down("md")),c=t==="doki"?"Dragoon Birthdays":"Birthdays!",[i,p]=h.useState("input"),[b,j]=h.useState(null),m=l(d=>d.inputTags),E=l(d=>d.setInputTags),v=l(d=>d.formattedRows),$=l(d=>d.setFormattedRows),k=l(d=>d.controls),O=l(d=>d.setControls),[f,a]=h.useState(null);h.useEffect(()=>{const d=localStorage.getItem(`tagFormatter_view_${t}`);d&&p(d),j(t)},[t]),h.useEffect(()=>{b===t&&localStorage.setItem(`tagFormatter_view_${t}`,i)},[i,t,b]);const R=()=>{oe({open:!0,title:"Clear Data",message:"Are you sure you want to clear all tags? This action cannot be undone.",confirmLabel:"Clear",onConfirm:()=>{E(""),$([]),O({}),p("input")}})},D=async()=>{try{const d=await navigator.clipboard.readText();if(!d.trim()){oe({open:!0,title:"Empty Clipboard",message:"Clipboard is empty or contains only whitespace.",confirmLabel:"OK",onConfirm:null});return}E(d),A(d)}catch{oe({open:!0,title:"Error",message:"Failed to read from clipboard. Please paste manually.",confirmLabel:"OK",onConfirm:null})}},A=(d=m)=>{if(!d.trim())return;const{newRows:C,newControls:g}=Wt(d,t,c);$(C),O(g),p("formatted")},M=()=>{if(!m.trim())return;const{newRows:d,newControls:C}=Wt(m,t,c),{rows:g,controls:T}=sn(v,k,d,C,c);$(g),O(T),p("formatted")},y=h.useCallback(d=>{const C=v.find(T=>T.id===d);if(!C)return;const g=!C.isEnabled;C.type==="header"?(O(T=>{const I=T[C.name];return I?{...T,[C.name]:{...I,isEnabled:g}}:T}),$(T=>T.map(I=>I.id===d?{...I,isEnabled:g}:I))):$(T=>T.map(I=>I.id===d?{...I,isEnabled:g}:I))},[v,O,$]),H=h.useCallback(d=>{a(d.id)},[]),q=h.useCallback(()=>{a(null)},[]),U=h.useCallback((d,C,g)=>{const T=v.find(F=>F.id===d);if(!T)return;const I=C.replace(/[\r\n]+/g," ");if(T.type==="header"){const F=T.name,S=I.trim();if(F===S&&(!g||g===T.timestamp)){q();return}if(!S){oe({open:!0,title:"Error",message:"Name cannot be empty",confirmLabel:"OK",onConfirm:null});return}if(S!==F&&k[S]){oe({open:!0,title:"Error",message:"A collection or chapter with this name already exists.",confirmLabel:"OK",onConfirm:null});return}O(B=>{const _={};return Object.keys(B).forEach(G=>{G===F?_[S]={...B[G]}:_[G]={...B[G]}}),_}),$(B=>{let _=B.map(G=>G.id===d?{...G,name:S,timestamp:g||G.timestamp,isEditing:!1}:G.parentName===F?{...G,parentName:S}:G);return g&&g!==T.timestamp&&(_=ht(_)),_})}else $(F=>{const S=F.map(B=>B.id===d?{...B,text:I,timestamp:g||B.timestamp,isEditing:!1}:B);return g&&g!==T.timestamp?ht(S):S});a(null)},[v,k,q,O,$]),ee=d=>{const g=!k[d]?.isEnabled;O(T=>({...T,[d]:{...T[d],isEnabled:g}})),$(T=>T.map(I=>I.type==="header"&&I.name===d?{...I,isEnabled:g}:I))},N=(d,C)=>{O(g=>{const T=Object.keys(g).filter(G=>g[G].type==="collection").sort((G,ge)=>g[G].order-g[ge].order),I=T.indexOf(d);if(I<0)return g;const F=I+C;if(F<0||F>=T.length)return g;const S=T[F],B={...g},_=B[d].order;return B[d]={...B[d],order:B[S].order},B[S]={...B[S],order:_},B})},W=h.useRef({}),[ae,z]=h.useState(null),[K,ce]=h.useState(null),me=h.useCallback(d=>{ce(d||null)},[]),ue=d=>{const C=v.find(g=>g.type==="header"&&g.name===d)?.id;C&&W.current[C]&&(W.current[C].scrollIntoView({behavior:"smooth",block:"center"}),z(C),setTimeout(()=>z(null),3e3))},[he,w]=h.useState(!1),Q=()=>{const d=ye();navigator.clipboard.writeText(d),w(!0),setTimeout(()=>w(!1),2e3)},[ie,oe]=h.useState({open:!1,title:"",message:"",onConfirm:null,confirmLabel:"Yes",cancelLabel:"Cancel"}),[J,V]=h.useState({offsetStart:"",offsetEnd:"",offsetAmount:"",enableStart:"",enableEnd:"",findText:"",replaceText:"",highlightThreshold:30,isHighlightTime:!1,isHighlightStar:!1,isHighlightCaps:!1,isHighlightCensored:!1,lastFilterType:"none"}),P=(d,C)=>{let g=C;["offsetStart","offsetEnd","offsetAmount","enableStart","enableEnd","highlightThreshold"].includes(d)&&(g=C.replace(/[^0-9:]/g,"")),V(T=>({...T,[d]:g}))},Z=d=>{if(!J.offsetAmount)return;const C=ve(J.offsetStart),g=J.offsetEnd?ve(J.offsetEnd):1/0,T=ve(J.offsetAmount)*d;$(I=>{const F=I.map(S=>{if(!S.timestamp)return S;const B=ve(S.timestamp);return B>=C&&B<=g?{...S,timestamp:nn(B+T)}:S});return ht(F)})},X=d=>{const C=ve(J.enableStart),g=J.enableEnd?ve(J.enableEnd):1/0;$(T=>T.map(I=>{if(I.type!=="tag"||!I.timestamp)return I;const F=ve(I.timestamp);return F>=C&&F<=g?{...I,isEnabled:d}:I}))},Y=()=>{if(!J.findText)return;const d=new RegExp(J.findText.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");let C=0;const g=v.map(T=>{if(T.type!=="tag")return T;const I=T.text.match(d);return I?(C+=I.length,{...T,text:T.text.replace(d,J.replaceText)}):T});C>0&&$(g),oe({open:!0,title:"Replace Results",message:C>0?`Replaced ${C} instance${C!==1?"s":""}.`:"No matches found.",confirmLabel:"OK",onConfirm:null})},de=h.useMemo(()=>{const d=[],C=[];let g=null;for(let F=0;F<v.length;F++){const S=v[F];if(S.type==="header"){const B=k[S.name];if(S.subtype==="hbd"){!B||B.isEnabled,C.push(S),g=null;continue}S.subtype==="collection"?B&&B.isEnabled?(g=[S],d.push(g)):g=null:((!B||B.isEnabled)&&C.push(S),g=null)}else if(S.subtype==="collection"){const B=S.parentName,_=k[B];_&&_.isEnabled&&g?g.push(S):C.push(S)}else S.subtype,C.push(S)}const T=F=>ve(F.timestamp||"00:00");return C.sort((F,S)=>{const B=F.subtype==="hbd"||!F.timestamp&&F.text?.includes("HBD"),_=S.subtype==="hbd"||!S.timestamp&&S.text?.includes("HBD");return B&&!_?1:!B&&_?-1:T(F)-T(S)}),d.sort((F,S)=>{const B=F[0].name,_=S[0].name;return(k[B]?.order||0)-(k[_]?.order||0)}),[...d.flat(),...C]},[v,k]),ye=()=>{const d=de.filter(I=>I.isEnabled),C={};d.forEach(I=>{I.type==="tag"&&I.parentName&&(C[I.parentName]=(C[I.parentName]||0)+1)});const g=d.filter(I=>I.type==="header"?C[I.name]>0:!0);return g.map((I,F)=>{let S="";if(F>0){const B=g[F-1],_=B.subtype==="collection"&&(B.type==="header"?k[B.name]?.isEnabled:k[B.parentName]?.isEnabled),G=I.subtype==="collection"&&(I.type==="header"?k[I.name]?.isEnabled:k[I.parentName]?.isEnabled);_&&!G&&I.type!=="header"&&(S=`
`),I.type==="header"&&(S=`
`)}return I.type==="header"?`${S}*${I.name}*`:S.length>0?`${S}${I.timestamp} ${I.text}`:`${I.timestamp} ${I.text}`.trim()}).join(`
`)},je=()=>e.jsxs(u,{sx:{display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",p:2},children:[e.jsx(u,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(ne,{variant:"text",color:"secondary",size:"small",disabled:!m,onClick:()=>E(""),children:"Clear Input"})}),e.jsx(re,{label:"Input Tags",multiline:!0,fullWidth:!0,variant:"outlined",value:m,onChange:d=>E(d.target.value),sx:{flexGrow:1,mb:2,"& .MuiInputBase-root":{height:"100%",alignItems:"flex-start"},"& textarea":{height:"100% !important",overflow:"auto !important"}}}),e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(ne,{variant:"outlined",color:"secondary",onClick:R,children:"Reset Data"}),v.length>0&&e.jsx(ne,{variant:"contained",color:"secondary",onClick:()=>p("formatted"),children:"Return to Formatted"}),v.length>0&&m.trim().length>0&&e.jsx(ne,{variant:"contained",color:"success",onClick:M,children:"Append Tags"}),m.trim().length>0&&e.jsx(ne,{variant:"contained",color:"primary",onClick:()=>{v.length>0?oe({open:!0,title:"Re-Format Tags",message:"This will reset any changes you made in the formatted view (edits, sorting, etc.). Are you sure?",confirmLabel:"Format",onConfirm:()=>A()}):A()},children:v.length>0?"Re-Format Tags":"Format Tags"}),v.length===0&&e.jsx(ne,{variant:"outlined",onClick:D,children:"Format from Clipboard"})]})]}),se=l(d=>d.density),we=h.useMemo(()=>{switch(se){case"compact":return{py:0,minHeight:"28px"};case"comfortable":return{py:1,minHeight:"42px"};default:return{py:.2,minHeight:"36px"}}},[se]),ke=h.useCallback((d,C)=>{W.current[d]=C},[]),Ce=h.useMemo(()=>{const d={};let C=0,g=0,T=0,I=0;const F=new Set;if(J.isHighlightTime){const S=parseFloat(J.highlightThreshold)||0;let B=-1,_=null;de.forEach(G=>{const ge=G.parentName&&k[G.parentName]&&!k[G.parentName].isEnabled,x=G.subtype==="collection",te=G.subtype==="hbd"||G.parentName===c;if(G.type==="tag"&&G.isEnabled&&!ge&&!x&&!te){const xe=G.timestamp?ve(G.timestamp):-1;xe!==-1&&(B!==-1&&xe-B<S&&(F.add(G.id),_&&F.add(_)),B=xe,_=G.id)}}),C=F.size}return de.forEach(S=>{if(S.type!=="tag")return;let B=!1;if(J.isHighlightCaps){const x=S.text.trim();/[a-zA-Z]/.test(x)&&x===x.toUpperCase()&&(B=!0,T++)}let _=!1;J.isHighlightStar&&S.text.includes("*")&&(_=!0,g++);let G=!1;J.isHighlightCensored&&S.wasCensored&&(G=!0,I++);let ge=null;F.has(S.id)&&(ge=n.palette.background.yellow),B&&(ge=n.palette.background.teal),_&&(ge=n.palette.background.red),G&&(ge=n.palette.background.orange),ge&&(d[S.id]=ge)}),{rowColors:d,countTime:C,countStar:g,countCaps:T,countCensored:I}},[de,J,k,c,n]),Le=()=>e.jsxs(Te,{elevation:3,sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",bgcolor:"background.default"},children:[e.jsxs(u,{sx:{p:1,display:"flex",alignItems:"center",gap:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(o,{variant:"h6",sx:{flexGrow:1},children:"Formatted Tags"}),e.jsx(ne,{variant:"outlined",color:"secondary",size:"small",onClick:()=>p("input"),children:"Back to Input"}),e.jsx(ne,{variant:"contained",color:he?"success":"primary",startIcon:he?e.jsx(yt,{}):e.jsx(Nn,{}),onClick:Q,size:"small",children:he?"Copied!":"Copy to Clipboard"})]}),e.jsx(u,{sx:{flexGrow:1,overflowY:"auto",p:1},children:de.map((d,C)=>{const g=d.parentName?k[d.parentName]:null,T=g&&!g.isEnabled;let I=0;if(C>0){const _=de[C-1],G=_.subtype==="collection"&&(_.type==="header"?k[_.name]?.isEnabled:k[_.parentName]?.isEnabled),ge=d.subtype==="collection"&&(d.type==="header"?k[d.name]?.isEnabled:k[d.parentName]?.isEnabled);G&&!ge&&d.type!=="header"&&(I=2)}if(d.type==="header"&&T)return null;let F=!1;d.type==="header"&&(F=v.some(_=>_.parentName===d.name&&_.isEnabled));const S=d.isEnabled&&F?1:.5,B=d.isEnabled&&F?"none":"line-through";return e.jsx(an,{row:d,isEditing:f===d.id,startEditing:H,saveEdit:U,cancelEdit:q,toggleRowEnabled:y,extraMarginTop:I,densityStyles:we,theme:n,highlightColor:Ce.rowColors[d.id],isHighlightedRow:ae===d.id,headerOpacity:S,headerDecoration:B,registerRef:ke,onMouseEnter:()=>d.parentName&&me(d.parentName),onMouseLeave:()=>me(null),isHighlightedParent:d.type==="header"&&d.name===K},d.id)})})]}),Re=()=>{const d={};return v.forEach(C=>{C.type==="tag"&&C.isEnabled&&C.parentName&&(d[C.parentName]=!0)}),e.jsxs(Te,{elevation:3,sx:{height:"100%",display:"flex",flexDirection:"column",p:1,overflow:"hidden"},children:[e.jsx(o,{variant:"h6",sx:{mb:1},children:"Headers"}),e.jsxs(u,{sx:{overflowY:"auto",flexGrow:1},children:[Object.keys(k).filter(C=>k[C].type==="collection").sort((C,g)=>(k[C].order||0)-(k[g].order||0)).map((C,g,T)=>{const F=!d[C]&&k[C].isEnabled;return e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(pt,{checked:k[C].isEnabled,onChange:()=>ee(C),size:"small"}),e.jsx(o,{variant:"body2",sx:{cursor:"pointer",fontWeight:"bold",textDecoration:F?"line-through":"none",opacity:F?.6:1},onClick:()=>ue(C),children:C}),e.jsx(u,{sx:{flexGrow:1}}),g>0&&e.jsx($e,{size:"small",onClick:()=>N(C,-1),children:e.jsx(Wn,{fontSize:"small"})}),g<T.length-1&&e.jsx($e,{size:"small",onClick:()=>N(C,1),children:e.jsx(zn,{fontSize:"small"})})]},C)}),Object.keys(k).filter(C=>k[C].type==="chapter").sort((C,g)=>{const T=v.find(B=>B.type==="header"&&B.name===C),I=v.find(B=>B.type==="header"&&B.name===g),F=T?ve(T.timestamp):1/0,S=I?ve(I.timestamp):1/0;return F-S}).map(C=>{const T=!d[C]&&k[C].isEnabled,I=C===K;return e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1,bgcolor:I?"action.hover":"transparent",borderRadius:1,pr:1},children:[e.jsx(pt,{checked:k[C].isEnabled,onChange:()=>ee(C),size:"small"}),e.jsx(o,{variant:"body2",sx:{cursor:"pointer",fontWeight:"bold",color:Ke[900],textDecoration:T?"line-through":"none",opacity:T?.6:1},onClick:()=>ue(C),children:C})]},C)}),Object.keys(k).filter(C=>k[C].type==="hbd").map(C=>{const T=!d[C]&&k[C].isEnabled;return e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(pt,{checked:k[C].isEnabled,disabled:!0,onChange:()=>ee(C),sx:{visibility:"hidden"},size:"small"}),e.jsx(o,{variant:"body2",sx:{cursor:"pointer",fontWeight:"bold",color:"primary.main",textDecoration:T?"line-through":"none",opacity:T?.6:1},onClick:()=>ue(C),children:C})]},C)})]})]})},L=()=>e.jsxs(Te,{elevation:3,sx:{height:"100%",p:2,overflowY:"auto"},children:[e.jsx(o,{variant:"h6",children:"Bulk Edit"}),e.jsxs(u,{sx:{mt:2,mb:3},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Offset Timestamps"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:1},children:[e.jsx(re,{label:"Start",size:"small",placeholder:"00:00",value:J.offsetStart,onChange:d=>P("offsetStart",d.target.value)}),e.jsx(re,{label:"End",size:"small",placeholder:"01:00",value:J.offsetEnd,onChange:d=>P("offsetEnd",d.target.value)})]}),e.jsxs(u,{sx:{display:"flex",gap:1},children:[e.jsx(re,{label:"Offset",size:"small",placeholder:"00:05",value:J.offsetAmount,onChange:d=>P("offsetAmount",d.target.value),sx:{flexGrow:1}}),e.jsx(fe,{title:"Add offset to timestamp",children:e.jsx(ne,{variant:"contained",size:"small",onClick:()=>Z(1),children:"+"})}),e.jsx(fe,{title:"Subtract offset from timestamp",children:e.jsx(ne,{variant:"contained",size:"small",color:"warning",onClick:()=>Z(-1),children:"-"})})]})]}),e.jsxs(u,{sx:{mb:3},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Enable/Disable Range"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:1},children:[e.jsx(re,{label:"Start",size:"small",placeholder:"00:00",value:J.enableStart,onChange:d=>P("enableStart",d.target.value)}),e.jsx(re,{label:"End",size:"small",placeholder:"01:00",value:J.enableEnd,onChange:d=>P("enableEnd",d.target.value)})]}),e.jsxs(u,{sx:{display:"flex",gap:1},children:[e.jsx(ne,{variant:"outlined",size:"small",fullWidth:!0,onClick:()=>X(!0),children:"Enable"}),e.jsx(ne,{variant:"outlined",size:"small",fullWidth:!0,color:"error",onClick:()=>X(!1),children:"Disable"})]})]}),e.jsxs(u,{sx:{mb:3},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Find & Replace"}),e.jsx(re,{label:"Find",size:"small",fullWidth:!0,sx:{mb:1},value:J.findText,onChange:d=>P("findText",d.target.value)}),e.jsx(re,{label:"Replace",size:"small",fullWidth:!0,sx:{mb:1},value:J.replaceText,onChange:d=>P("replaceText",d.target.value)}),e.jsx(ne,{variant:"contained",size:"small",fullWidth:!0,onClick:Y,children:"Replace All"})]}),e.jsxs(u,{sx:{mb:3},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Highlight timestamps that:"}),e.jsxs(u,{sx:{mb:1},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(We,{checked:J.isHighlightTime,onChange:d=>P("isHighlightTime",d.target.checked),size:"small",sx:{mr:1}}),e.jsx(o,{variant:"body2",sx:{mr:.5,whiteSpace:"nowrap"},children:"are under"}),e.jsx(re,{size:"small",variant:"standard",value:J.highlightThreshold,onChange:d=>P("highlightThreshold",d.target.value),disabled:!J.isHighlightTime,sx:{width:"40px",mr:.5,"& input":{textAlign:"center"}}}),e.jsx(o,{variant:"body2",sx:{mr:.5,whiteSpace:"nowrap"},children:"seconds apart"})]}),J.isHighlightTime&&e.jsx(u,{sx:{pl:5,mt:.5},children:e.jsxs(u,{sx:{display:"inline-block",bgcolor:n.palette.background.yellow,color:n.palette.getContrastText(n.palette.background.yellow),px:1,borderRadius:1,fontSize:"0.75rem",fontWeight:"bold"},children:[Ce.countTime," found"]})})]}),e.jsxs(u,{sx:{mb:1,display:"flex",alignItems:"center"},children:[e.jsx(We,{checked:J.isHighlightCensored,onChange:d=>P("isHighlightCensored",d.target.checked),size:"small",sx:{mr:1}}),e.jsx(o,{variant:"body2",sx:{mr:1,flexGrow:1},children:"are censored/filtered"}),J.isHighlightCensored&&e.jsxs(u,{sx:{display:"inline-block",bgcolor:n.palette.background.orange,color:n.palette.getContrastText(n.palette.background.orange),px:1,borderRadius:1,fontSize:"0.75rem",fontWeight:"bold"},children:[Ce.countCensored," found"]})]}),e.jsxs(u,{sx:{mb:1,display:"flex",alignItems:"center"},children:[e.jsx(We,{checked:J.isHighlightStar,onChange:d=>P("isHighlightStar",d.target.checked),size:"small",sx:{mr:1}}),e.jsx(o,{variant:"body2",sx:{mr:1,flexGrow:1},children:"contain a *"}),J.isHighlightStar&&e.jsx(u,{sx:{pl:5,mt:.5},children:e.jsxs(u,{sx:{display:"inline-block",bgcolor:n.palette.background.red,color:n.palette.getContrastText(n.palette.background.red),px:1,borderRadius:1,fontSize:"0.75rem",fontWeight:"bold"},children:[Ce.countStar," found"]})})]}),e.jsxs(u,{sx:{mb:1,display:"flex",alignItems:"center"},children:[e.jsx(We,{checked:J.isHighlightCaps,onChange:d=>P("isHighlightCaps",d.target.checked),size:"small",sx:{mr:1}}),e.jsx(o,{variant:"body2",sx:{mr:1,flexGrow:1},children:"are all caps"}),J.isHighlightCaps&&e.jsx(u,{sx:{pl:5,mt:.5},children:e.jsxs(u,{sx:{display:"inline-block",bgcolor:n.palette.background.teal,color:n.palette.getContrastText(n.palette.background.teal),px:1,borderRadius:1,fontSize:"0.75rem",fontWeight:"bold"},children:[Ce.countCaps," found"]})})]})]})]});return e.jsxs(e.Fragment,{children:[i==="input"?je():e.jsxs(u,{sx:{display:"flex",flexDirection:s?"column":"row",height:"calc(100vh - 64px)",p:2,gap:2},children:[e.jsx(u,{sx:{flexMatched:!0,flex:s?"0 0 500px":"0 0 70%",height:s?"50vh":"100%",overflow:"hidden"},children:Le()}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",flex:s?1:"0 0 30%",height:s?"auto":"100%",gap:2},children:[e.jsx(u,{sx:{display:"flex",flexDirection:"column",flex:s?1:"0 1 auto",maxHeight:s?"none":"50%",overflow:"hidden"},children:Re()}),e.jsx(u,{sx:{display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},children:L()})]})]}),e.jsxs(et,{open:ie.open,onClose:()=>oe(d=>({...d,open:!1})),children:[e.jsx(at,{children:ie.title}),e.jsx(tt,{children:e.jsx(On,{children:ie.message})}),e.jsxs(rt,{children:[ie.onConfirm&&e.jsx(ne,{onClick:()=>oe(d=>({...d,open:!1})),color:"primary",children:ie.cancelLabel}),e.jsx(ne,{onClick:()=>{ie.onConfirm&&ie.onConfirm(),oe(d=>({...d,open:!1}))},color:"secondary",autoFocus:!0,children:ie.confirmLabel||"OK"})]})]})]})};function Yi({wsKey:t,jumpToLine:n}){const s=l(Y=>Y.lineMenuId),c=l(Y=>Y.activeId),i=l(Y=>Y.pastStreamViewing),p=l(Y=>Y.transcript),b=l(Y=>Y.pastStreamTranscript),j=i?b:p,m=l(Y=>Y.startTime),E=l(Y=>Y.mediaType),v=l(Y=>Y.mediaBaseUrl),$=l(Y=>Y.clipStartIndex),k=l(Y=>Y.setLineMenuId),O=l(Y=>Y.setAudioId),f=l(Y=>Y.setClipStartIndex),a=l(Y=>Y.setClipEndIndex),R=l(Y=>Y.setClipPopupOpen),D=i||c,A=document.getElementById(`line-button-${s}`),M=s>-1?!!A:!1,y=j.filter(Y=>Y.id===s)[0],H=y?.timestamp,q=De(H,m),U=en(v,t,D,y?.fileId,s);let ee="";/^\d+$/.test(D)?ee=`https://www.twitch.tv/videos/${D}?t=${q}`:ee=`https://www.youtube.com/live/${D}?t=${q}`;const N=()=>{k(-1)},W=()=>{n(s),k(-1)},ae=()=>{f(s),N()},z=()=>{a(s),R(!0),N()},K=()=>{f(-1),a(-1),N()},ce=()=>{window.open(U,"_blank"),N()},me=()=>{O(s),N()},ue=()=>{window.open(ee,"_blank"),N()},he=()=>{navigator.clipboard.writeText(H)},w=E==="audio"||E==="video",Q=Y=>E==="none"?!0:j.find(ye=>ye.id===Y)?.mediaAvailable!==!1,ie=(Y,de)=>{if(E==="none")return!0;const ye=Math.min(Y,de),je=Math.max(Y,de);return!j.find(we=>we.id>=ye&&we.id<=je&&we.mediaAvailable===!1)},oe=Q(s),J=w&&$<0&&oe,V=w&&!J&&s!==$&&Math.abs($-s)<it&&ie($,s),P=w&&!J;let Z={vertical:"bottom",horizontal:"left"},X={vertical:"top",horizontal:"left"};return $>=0&&s<$&&(Z={vertical:"top",horizontal:"left"},X={vertical:"bottom",horizontal:"left"}),e.jsxs(_n,{id:"line-menu","data-testid":"line-menu",anchorEl:A,open:M,onClose:N,anchorOrigin:Z,transformOrigin:X,children:[e.jsxs(le,{disabled:!0,children:["id: ",s>-1?s:""]}),J&&e.jsx(le,{onClick:ae,children:"Start Clip"}),V&&e.jsx(le,{onClick:z,children:"Process Clip"}),P&&e.jsx(le,{onClick:K,children:"Reset Clip"}),w&&e.jsx(le,{onClick:ce,children:"Download Audio"}),w&&e.jsx(le,{onClick:me,disabled:!oe,children:"Play Audio"}),e.jsx(le,{onClick:ue,children:"Open Stream"}),e.jsx(le,{onClick:he,children:"Copy Timestamp"}),e.jsx(le,{onClick:W,children:"Jump to line"})]})}function Xi({startTime:t}){const[n,s]=h.useState(t);h.useEffect(()=>{const b=setInterval(()=>{s(Math.floor(Date.now()/1e3))},1e3);return()=>clearInterval(b)},[]);const c=l(b=>b.lastLineReceivedAt),[i,p]=h.useState(0);return h.useEffect(()=>{const b=setInterval(()=>{c>0?p(Date.now()-c):p(0)},100);return()=>clearInterval(b)},[c]),e.jsxs(u,{sx:{mb:2},children:[e.jsxs(o,{variant:"subtitle1",component:"div",children:["Time since start: ",De(n,t)]}),c>0&&e.jsxs(o,{variant:"subtitle2",component:"div",sx:{color:"text.secondary"},children:["Time since last line: ",(i/1e3).toFixed(1),"s"]})]})}function Zi(){const t=Se("(max-width:768px)"),n=Math.max(Math.ceil((window.innerHeight-200)/36),1),s=Array.from(new Array(n));return e.jsxs("div",{className:"transcript",children:[e.jsx(u,{sx:{display:"flex",width:"100%",alignItems:"center",justifyContent:"center",mb:3},children:e.jsx(ot,{variant:"rounded",width:t?"100%":"50%",height:30})}),s.map((c,i)=>{const p=Math.max(1-i/s.length,.15);return e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1.5,opacity:p},children:[e.jsx(ot,{variant:"circular",width:24,sx:{mr:1}}),e.jsx(ot,{variant:"text",width:80,sx:{mr:1}}),e.jsx(ot,{variant:"text",width:"100%"})]},i)})]})}function Qi({serverStatus:t="loading"}){const n=t==="offline",s=t==="connecting"?"Connecting...":"Loading Transcript...";return e.jsx(e.Fragment,{children:n?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",height:"50vh"},children:[e.jsx(Vn,{color:"error",sx:{fontSize:60,mb:2}}),e.jsx(o,{variant:"h5",component:"h2",sx:{mb:1},children:"Connection Failed"}),e.jsx(o,{color:"text.secondary",children:"Could not establish a connection to the server."})]}):e.jsxs(u,{sx:{height:"95vh",overflow:"hidden"},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(ot,{variant:"text",width:"90%",height:40,sx:{mb:1}}),e.jsx(o,{variant:"h5",color:"primary",sx:{mb:1},children:s})]}),e.jsx("hr",{}),e.jsx(Zi,{})]})})}const Ki=ut("span")(({theme:t})=>({cursor:"pointer","&:hover":{backgroundColor:t.palette.secondary.background}}));function ea({id:t,timestamp:n,text:s,onClick:c,tags:i}){const p=Xt();if(!l(v=>v.enableTagHelper))return e.jsx(e.Fragment,{children:s});let j={},m=null;if(i&&i.length>0){let v=null,$=!1,k=!1,O=!1;i.forEach(f=>{f.subtype==="hbd"&&($=!0),f.subtype==="chapter"&&(k=!0),f.subtype==="collection"&&(O=!0)}),$?v=Un[300]:k?v=Ke[700]:O?v=st[300]:v=Zt[300],j={borderBottom:`2px solid ${v}`,display:"inline-block",lineHeight:"1.2"},m=e.jsx(u,{sx:{p:.5},children:i.map((f,a)=>e.jsx(o,{variant:"caption",display:"block",children:f.type==="header"?e.jsxs("strong",{children:[f.subtype,": ",f.name]}):e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:["[",f.timestamp,"]"]})," ",f.text]})},f.id||a))})}const E=e.jsx(Ki,{"data-testid":`transcript-segment-${t}`,theme:p,onClick:()=>c(n,s),style:j,children:s});return m?e.jsx(fe,{title:m,arrow:!0,children:E}):E}const _t=h.memo(ea),ta=ut("span")(({theme:t})=>({"&":{color:t.palette.timestamp.main}})),na=Gn`
  0% {
    rotate: 90deg;
  }
  50% {
    rotate: 270deg;
  }
  100% {
    rotate: 450deg;
  }
`,kt=h.memo(h.forwardRef(({id:t,lineTimestamp:n,segments:s,highlight:c,tagsMap:i,startTime:p,...b},j)=>{const m=Xt(),E=l(P=>P.setTagPopupOpen),v=l(P=>P.setTagPopupTimestamp),$=l(P=>P.setTagPopupText),k=l(P=>P.setLineMenuId),O=l(P=>P.setClipPopupOpen),f=l(P=>P.setClipStartIndex),a=l(P=>P.setClipEndIndex),R=l(P=>P.startTime),D=l(P=>P.timeFormat),A=l(P=>P.density),M=l(P=>P.mediaType),y=p??R,H=M!=="none"&&b.mediaAvailable===!1,{isSelected:q,isInClipRange:U,isPlaying:ee,isClipable:N,isClipStart:W,clipMode:ae,clipStartIndex:z,isRangeValid:K}=l(qn(P=>{const{lineMenuId:Z,clipStartIndex:X,clipEndIndex:Y,audioId:de,clipInvalidBefore:ye,clipInvalidAfter:je,clipMode:se}=P,we=(Re,L,d)=>Re<=d&&d<=L||L<=d&&d<=Re,ke=X>=0&&(t<X?t>(ye??-1):t<(je??Number.MAX_SAFE_INTEGER)),Ce=Z>=0&&X>=0&&we(X,Z,t),Le=Y>=0&&X>=0&&we(X,Y,t);return{isSelected:Z===t,isClipStart:X===t,isInClipRange:ke&&(Ce||Le)&&Math.abs(X-t)<it,isPlaying:de===t,isClipable:X>=0&&Math.abs(X-t)<it&&ke,clipMode:se,clipStartIndex:X,isRangeValid:ke}})),ce=(P,Z)=>{v(P),$(Z),E(!0)},me=h.useMemo(()=>H?!1:z===-1?!0:K&&Math.abs(z-t)<it,[H,z,K,t]),ue=()=>{if(ae){if(!me)return;z===-1?f(t):z===t?f(-1):(a(t),O(!0))}else k(t)},he=P=>D==="relative"?De(P,y):D==="local"?Qe(P):D==="UTC"?St(P):P,w=c?m.palette.action.selected:W||U?m.palette.lineground.clip:q||ee?m.palette.lineground.main:"transparent",Q=H?m.palette.id.loading:ae?me?m.palette.secondary.main:m.palette.action.disabled:N?m.palette.id.clip:m.palette.id.main,ie=s?.length>0,oe=A==="comfortable"?"medium":"small",J=A==="compact"?{padding:0}:{},V=m.palette.timestamp.main;return e.jsxs(o,{ref:j,className:c?"highlight":"",color:"secondary","aria-live":"assertive",padding:"1px",whiteSpace:"pre-wrap",align:"left",id:t,role:"transcript-line","data-testid":`transcript-line-${t}`,sx:{backgroundColor:w,wordBreak:"break-word","&:hover":{textDecoration:"underline"}},children:[e.jsx(fe,{title:H?"Media isn't available yet":"",children:e.jsx($e,{size:oe,sx:{...J,animation:H?`${na} 1.5s infinite ease-in-out`:"none"},onClick:ue,id:`line-button-${t}`,"data-testid":H?`line-button-${t}-loading`:`line-button-${t}`,disabled:ae&&!me,children:ae?W?e.jsx(Jt,{style:{color:Q},"data-testid":"RestartAltIcon"}):me?e.jsx(Qt,{style:{color:Q},"data-testid":"ContentCutIcon"}):e.jsx(At,{style:{color:Q},"data-testid":"MoreHorizIcon"}):e.jsx(At,{style:{color:Q},"data-testid":"MoreHorizIcon"})})})," ","[",e.jsx(ta,{theme:m,style:{color:V},children:he(n)}),"]"," ",ie?s.map((P,Z)=>{const X=i?.get(`${t}_${Z}`);return e.jsxs(h.Fragment,{children:[e.jsx(_t,{id:Z,timestamp:P?.timestamp,text:P?.text,onClick:ce,tags:X}),e.jsx("span",{}),Z<s.length-1&&" "]},`line-${t}-segment-${Z}`)}):e.jsx(_t,{id:0,timestamp:n,text:"          ",onClick:ce,tags:i?.get(`${t}_0`)})]})}));function sa({displayData:t,transcriptLength:n,searchTerm:s,setSearchTerm:c,isLive:i,isOnline:p,pendingJumpId:b,setPendingJumpId:j,tagsMap:m,startTime:E}){const v=Se("(max-width:768px)"),$=h.useRef(null),[k]=h.useState(()=>b!==-1?t.findIndex(N=>N.id===b):-1),[O,f]=h.useState(k===-1),[a,R]=h.useState(0),[D,A]=h.useState({startIndex:0,endIndex:0}),M=h.useRef(n),y=h.useRef(null),H=h.useRef(0),[q,U]=h.useState(-1);h.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]);const ee=()=>{$.current&&$.current.scrollToIndex({index:t.length-1,align:"end",behavior:"auto"})};return h.useEffect(()=>{const N=n-M.current;M.current=n,N>0&&(H.current=Date.now(),O||R(W=>W+N))},[n,O]),h.useEffect(()=>{if(b!==-1){const N=t.findIndex(W=>W.id===b);N!==-1&&($.current&&$.current.scrollToIndex({index:N,align:"start",behavior:"auto"}),setTimeout(()=>{f(!1),U(b),j(-1),setTimeout(()=>{U(-1)},2e3)},100))}},[t,b,j]),e.jsxs(u,{sx:{flexGrow:1,position:"relative",minHeight:0},children:[t.length===0?n===0?e.jsx(o,{children:"No transcripts at this time."}):e.jsx(o,{children:"Nothing found."}):e.jsx(Jn,{ref:$,data:t,atBottomStateChange:N=>{N?(y.current&&(clearTimeout(y.current),y.current=null),f(!0),R(0)):(y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{f(!1)},250))},itemContent:(N,W)=>e.jsx(kt,{id:W.id,lineTimestamp:W.timestamp,segments:W.segments,highlight:q===W.id,mediaAvailable:W.mediaAvailable,tagsMap:m,startTime:E},`streamLogsLine-${W.id}`),followOutput:O?"auto":!1,initialTopMostItemIndex:k!==-1?k:t.length-1,style:{height:"100%"},components:{Footer:()=>e.jsx(u,{sx:{height:50}})},defaultItemHeight:30,rangeChanged:N=>{const W=t.length-1-N.endIndex;A(N),O&&W>4&&f(!1)}}),e.jsx(u,{sx:{position:"absolute",bottom:0,left:0,right:0,display:"flex",justifyContent:"center",p:1,zIndex:10,pointerEvents:"none"},children:e.jsxs(Te,{elevation:4,"data-testid":"transcript-virtual-toolbar",sx:{pointerEvents:"auto",display:"flex",alignItems:"center",gap:1,padding:"4px 12px",borderRadius:"24px",backgroundColor:"background.paper",border:"1px solid",borderColor:"divider"},children:[e.jsx(fe,{title:"Jump to Top",children:e.jsx($e,{size:"small","data-testid":"transcript-jumpToTop",onClick:()=>{f(!1),$.current?.scrollToIndex({index:0,align:"start",behavior:"auto"})},children:e.jsx(Yn,{fontSize:"small"})})}),e.jsx(ft,{orientation:"vertical",flexItem:!0,sx:{height:20,my:"auto"}}),!v&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"caption",sx:{minWidth:60,textAlign:"center",fontFamily:"monospace"},children:s?`${t.length} / ${n} found`:!O&&D.endIndex<n-1?`${D.startIndex+1}-${D.endIndex+1} / ${n}`:`${n} lines`}),e.jsx(ft,{orientation:"vertical",flexItem:!0,sx:{height:20,my:"auto"}})]}),i?e.jsx(fe,{title:s?"Click to clear search and jump to live":O?"Click to pause auto-scroll":"Click to resume auto-scroll live updates",children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",cursor:"pointer",gap:.5,mx:.5},onClick:()=>{s?(c(""),f(!0),R(0),ee()):O?f(!1):(f(!0),R(0),ee())},children:[e.jsx($e,{size:"small",color:s||O?"primary":"warning",sx:{p:.5},children:s?e.jsx(Kt,{fontSize:"small"}):O?e.jsx(Xn,{fontSize:"small"}):e.jsx(Gt,{fontSize:"small"})}),e.jsx(o,{variant:"caption",sx:{minWidth:40,whiteSpace:"nowrap",fontWeight:"bold",color:s||O?"primary.main":"warning.main"},children:s?"Searching":O?"Live":a>0?`Paused (${a})`:"Paused"})]})}):e.jsx(o,{variant:"caption",sx:{minWidth:45,whiteSpace:"nowrap"},children:"Offline"}),!O&&(!i||!!s)&&e.jsxs(e.Fragment,{children:[e.jsx(ft,{orientation:"vertical",flexItem:!0,sx:{height:20,my:"auto",ml:1,mr:.5}}),e.jsx(fe,{title:"Jump to Bottom",children:e.jsx($e,{size:"small",color:"primary","data-testid":"transcript-jumpToBottom",onClick:()=>{p&&i&&(f(!0),R(0)),ee()},children:e.jsx(Zn,{fontSize:"small"})})})]})]})})]})}function ia({displayData:t,pendingJumpId:n,setPendingJumpId:s,tagsMap:c,startTime:i}){const[p,b]=h.useState(1),j=h.useRef(new Map),m=300,E=Math.ceil(t.length/m);let v=Math.max(Math.min(E,p),1);v!==p&&E>0&&b(v);const $=(a,R)=>{b(R)};let k=0,O=0,f=[];return t.length>0&&(k=t.length-v*m,O=k+m,f=t.slice(Math.max(0,k),Math.min(t.length,O)).reverse()),h.useEffect(()=>{if(n===-1)return;const a=t.findIndex(R=>R.id===n);if(a!==-1){const R=t.length-1-a,D=Math.floor(R/m)+1;b(D),setTimeout(()=>{const A=j.current.get(n);A&&(A.scrollIntoView({behavior:"auto",block:"center"}),A.classList.add("highlight"),setTimeout(()=>{A.classList.remove("highlight")},2e3)),s(-1)},100)}else s(-1)},[n,t,s]),e.jsx(u,{sx:{bgcolor:"background.default"},children:f.length===0?e.jsx(o,{children:"Nothing found."}):e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"1rem"},children:e.jsx(Ft,{count:E,page:v,onChange:$,showFirstButton:!0,showLastButton:!0,"data-testid":"transcript-pagination"})}),f.map(a=>e.jsx(kt,{ref:R=>{R?j.current.set(a.id,R):j.current.delete(a.id)},id:a.id,lineTimestamp:a.timestamp,segments:a.segments,mediaAvailable:a.mediaAvailable,tagsMap:c,startTime:i},`streamLogsLine-${a.id}`)),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px"},children:e.jsx(Ft,{count:E,page:v,onChange:$,showFirstButton:!0,showLastButton:!0})})]})})}const rn=({src:t,alt:n,style:s,...c})=>{const[i,p]=h.useState(!1),[b,j]=h.useState(t);return t!==b&&(j(t),p(!1)),i?e.jsxs(u,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"action.disabledBackground",color:"text.secondary"},children:[e.jsx(Qn,{sx:{fontSize:40}}),e.jsx(o,{variant:"body2",children:"Image Unavailable"})]}):e.jsx("img",{src:t,alt:n,onError:()=>p(!0),style:s,...c})},on=h.memo(({mediaBaseUrl:t,line:n,tagsMap:s,activeId:c,wsKey:i,lastSelectedId:p,onFrameClick:b,startTime:j})=>{const m=mt(),E=l(R=>R.timeFormat),v=l(R=>R.startTime),$=j??v,k=R=>E==="relative"?De(R,$):E==="local"?Qe(R):E==="UTC"?St(R):Qe(R);let O="transparent";const f=[];if(s&&n.segments){let R=!1,D=!1,A=!1;n.segments.forEach((M,y)=>{const H=`${n.id}_${y}`,q=s.get(H);q&&q.forEach(U=>{U.type==="header"?(U.subtype==="chapter"&&(R=!0),U.subtype==="collection"&&(D=!0),f.push(`[${U.subtype}] ${U.name}`)):(U.subtype==="collection"&&(D=!0),A=!0,f.push(U.text))})}),R?O=Ke[500]:D?O=st[500]:A&&(O=Zt[500])}const a=f.length>0?e.jsx(u,{children:f.map((R,D)=>e.jsx(o,{variant:"body2",children:R},D))}):"";return e.jsx(u,{"data-testid":`transcript-frame-${n.id}`,role:"transcript-frame",sx:{width:"100%"},children:e.jsx(fe,{title:a,arrow:!0,placement:"top",children:e.jsxs(Te,{elevation:2,sx:{cursor:"pointer",overflow:"hidden",position:"relative",outline:n.id===p?`3px solid ${m.palette.primary.main}`:"none",border:`4px solid ${O}`,"&:hover":{outline:`3px solid ${m.palette.primary.light}`},aspectRatio:"16/9",boxSizing:"border-box"},onClick:()=>b(n),children:[n.mediaAvailable?e.jsx(rn,{src:tn(t,i,c,n.fileId),alt:`Frame ${n.id}`,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):e.jsx(u,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"action.disabledBackground"},children:e.jsx(Ye,{size:24,color:"secondary"})}),e.jsx(u,{sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"rgba(0, 0, 0, 0.6)",color:"white",p:.5,textAlign:"center"},children:e.jsx(o,{variant:"caption",sx:{display:"block",lineHeight:1},children:k(n.timestamp)})})]})})})});on.displayName="FrameItem";const aa=ut(u)(({theme:t})=>({padding:t.spacing(.5),display:"flex",flexDirection:"column",boxSizing:"border-box"})),ra=ut(u)(()=>({display:"flex",flexWrap:"wrap",justifyContent:"center"}));function oa({mediaBaseUrl:t,displayData:n,activeId:s,wsKey:c,tagsMap:i,startTime:p}){const b=mt(),j=Se(b.breakpoints.down("sm")),[m,E]=h.useState(null),v=h.useRef(null),[$,k]=h.useState(null),O=h.useRef(null),f=h.useMemo(()=>[...n].reverse(),[n]),a=h.useMemo(()=>j?"50%":"200px",[j]),R=A=>{E(A),k(A.id)};h.useEffect(()=>{v.current=m},[m]),h.useEffect(()=>{const A=M=>{const y=v.current;if(y&&["ArrowRight","ArrowLeft"].includes(M.key)){M.preventDefault();const H=f.findIndex(W=>W.id===y.id);if(H===-1)return;let q=H;const U=M.shiftKey,ee=600,N=M.key==="ArrowRight";if(U){const W=y.timestamp+(N?ee:-ee);let ae=H,z=Math.abs(f[H].timestamp-W);if(N)for(let K=H-1;K>=0;K--){const ce=Math.abs(f[K].timestamp-W);if(ce<=z)z=ce,ae=K;else break}else for(let K=H+1;K<f.length;K++){const ce=Math.abs(f[K].timestamp-W);if(ce<=z)z=ce,ae=K;else break}q=ae}else N?q=Math.max(0,H-1):q=Math.min(f.length-1,H+1);if(q!==H){const W=f[q];E(W),k(W.id),O.current?.scrollToIndex({index:q,align:"center"})}}};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[f]);const D=()=>{E(null)};return e.jsxs(u,{sx:{flexGrow:1,height:"100%",minHeight:0},children:[n.length===0?e.jsx(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(o,{children:"No frames available."})}):e.jsx(Kn,{ref:O,style:{height:"100%"},data:f,components:{List:ra,Item:({children:A,...M})=>e.jsx(aa,{...M,sx:{width:a},children:A})},itemClassName:"frame-item",itemContent:(A,M)=>e.jsx(on,{mediaBaseUrl:t,line:M,tagsMap:i,activeId:s,wsKey:c,lastSelectedId:$,onFrameClick:R,startTime:p})}),e.jsx(et,{open:!!m,onClose:D,maxWidth:"md",fullWidth:!0,children:e.jsx(tt,{children:m&&e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(u,{sx:{width:"100%",aspectRatio:"16/9",overflow:"hidden",borderRadius:1,bgcolor:"black",display:"flex",justifyContent:"center",alignItems:"center"},children:m.mediaAvailable?e.jsx(rn,{src:tn(t,c,s,m.fileId),alt:`Frame ${m.id}`,style:{width:"100%",height:"100%",objectFit:"contain"}}):e.jsx(Ye,{color:"secondary"})}),e.jsx(Te,{sx:{p:1},children:e.jsx(kt,{id:m.id,lineTimestamp:m.timestamp,segments:m.segments,mediaAvailable:m.mediaAvailable,tagsMap:i,startTime:p})})]})})})]})}function la(){return e.jsx(u,{sx:{position:"fixed",top:16,right:16,zIndex:9999,maxWidth:300},children:e.jsxs(Yt,{severity:"warning",variant:"filled",sx:{py:0,px:2,fontSize:"0.875rem",boxShadow:3},children:["Lost connection. Reconnecting",e.jsx("span",{className:"loading-dots"})]})})}function ca(){const t=l(a=>a.activeTitle),n=l(a=>a.pastStreams),s=l(a=>a.pastStreamViewing),c=l(a=>a.setPastStreamViewing),i=l(a=>a.setAudioId),p=l(a=>a.setClipStartIndex),b=l(a=>a.setClipEndIndex),j=l(a=>a.isLive),m=l(a=>a.startTime),E=l(a=>a.mediaType),v=Se("(max-width:768px)"),$=j?"live":"offline",k=a=>{const R=a.target.value;c(R==="live"?null:R),i(-1),p(-1),b(-1)},O=e.jsxs("div",{children:[e.jsxs("p",{style:{margin:0},children:[e.jsx("strong",{children:"Stream status:"})," ",$]}),e.jsxs("p",{style:{margin:"4px 0 0"},children:[e.jsx("strong",{children:"Start Time:"})," ",Qe(m)]}),e.jsxs("p",{style:{margin:"4px 0 0"},children:[e.jsx("strong",{children:"Media Available:"})," ",E==="video"?"Video and Audio":E==="audio"?"Audio Only":"None"]})]}),f=[...n].sort((a,R)=>R.startTime-a.startTime);return e.jsxs(e.Fragment,{children:[" ",f.length>0?e.jsx(Ve,{variant:"standard",sx:{minWidth:200,pl:v?6:0,maxWidth:"100%"},children:e.jsxs(Je,{value:s||"live",onChange:k,displayEmpty:!0,inputProps:{"aria-label":"Select Stream"},sx:{fontSize:"1.5rem",color:s?Ke[500]:"primary.main",fontWeight:400,"&:before":{borderBottom:"none"},"&:after":{borderBottom:"none"},"& .MuiSelect-select":{paddingRight:4,whiteSpace:"normal"}},MenuProps:{PaperProps:{style:{maxHeight:300}}},children:[e.jsx(le,{value:"live",children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(o,{variant:"body1",sx:{fontWeight:"bold"},children:t||"Live Stream"}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"Live"})]})}),f.map(a=>e.jsx(le,{value:a.activeId,children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(o,{variant:"body1",sx:{whiteSpace:"normal"},children:a.activeTitle||"Untitled Stream"}),e.jsx(o,{variant:"caption",color:"text.secondary",children:`${new Date(a.startTime*1e3).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})} ${Qe(a.startTime)}`})]})},a.activeId))]})}):e.jsx(fe,{title:O,children:e.jsx(o,{color:"primary",variant:"h5",component:"h5",sx:{wordBreak:"break-word",pl:v?6:0},children:t})})]})}function da({wsKey:t}){const n=l(L=>L.activeId),s=l(L=>L.activeTitle),c=l(L=>L.isLive),i=l(L=>L.startTime),p=l(L=>L.mediaType),b=l(L=>L.mediaBaseUrl),j=l(L=>L.transcript),m=l(L=>L.serverStatus),E=l(L=>L.transcriptHeight),v=l(L=>L.devMode),$=l(L=>L.useVirtualList),k=l(L=>L.setUseVirtualList),O=l(L=>L.formattedRows),f=l(L=>L.clipMode),a=l(L=>L.toggleClipMode),R=l(L=>L.clipStartIndex),D=l(L=>L.pastStreams),A=l(L=>L.pastStreamViewing),M=l(L=>L.setPastStreamViewing),y=l(L=>L.pastStreamTranscript),H=l(L=>L.setPastStreamTranscript),q=l(L=>L.resetPastStreamTranscript),[U,ee]=h.useState(""),[N,W]=h.useState(-1),[ae,z]=h.useState(!1),[K,ce]=h.useState(!1),[me,ue]=h.useState(null);h.useEffect(()=>{let L=!0;return(async()=>{if(!A){q(),ce(!1),ue(null);return}ce(!0),ue(null);try{const C=await fetch(`${Ue}/${t}/transcript/${A}`);if(!C.ok)throw new Error("Failed to fetch transcript");const g=await C.json();L&&H(g)}catch(C){L&&ue(C.message)}finally{L&&ce(!1)}})(),()=>{L=!1}},[A,t,H,q]),h.useEffect(()=>{A&&D.length>0&&(D.some(d=>d.activeId===A)||(M(null),q()))},[A,D,M,q]);const[he,w]=h.useState($?1:0);let Q=he;(he!==2||p!=="video")&&(Q=$?1:0),Q!==he&&w(Q);const ie=Se("(max-width:768px)"),oe=m==="online",J=j.length===0&&s==="",P=`calc(${{"100%":"100vh","90%":"90vh","75%":"75vh","50%":"50vh"}[E]||"100vh"} - 24px)`,Z=A?y:j,X=h.useMemo(()=>A?D.find(L=>L.activeId===A):null,[A,D]),Y=A?X?.isLive??!1:c,de=A?X?.startTime??0:i,ye=h.useMemo(()=>U?Z.filter(L=>{let d="";return L?.segments?.forEach(C=>{d+=C.text+" "}),d.toLowerCase().includes(U.toLowerCase())}):Z,[Z,U]),je=h.useMemo(()=>{if(Z.length<2)return!1;for(let L=1;L<Z.length;L++)if(Z[L].id!==Z[L-1].id+1)return!0;return!1},[Z]),se=ye,we=L=>{he===2&&w($?1:0),U&&ee(""),W(L)},ke=(L,d)=>{w(d),d===0?k(!1):d===1&&k(!0)},Ce=h.useMemo(()=>{const L=new Map;if(!O||!se||se.length===0)return L;const d=se[0],C=se[se.length-1],g=d.timestamp,T=C.timestamp;return O.forEach(I=>{if(I.timestamp){const F=ve(I.timestamp),S=(de||0)+F;if(S<g||S>T)return;let B=0,_=se.length-1,G=-1,ge=1/0;for(;B<=_;){const te=Math.floor((B+_)/2),be=se[te].timestamp-S;if(Math.abs(be)<ge&&(ge=Math.abs(be),G=te),be===0){G=te;break}else be<0?B=te+1:_=te-1}let x=se[G];if(x){[G-1,G,G+1].forEach(Me=>{if(Me>=0&&Me<se.length){const Ee=se[Me];Math.abs(Ee.timestamp-S)<Math.abs(x.timestamp-S)&&(x=Ee)}});let xe=0,be=Math.abs(x.timestamp-S);if(x.segments&&x.segments.length>0){let Me=Math.abs(x.segments[0].timestamp-S);for(let Ee=1;Ee<x.segments.length;Ee++){const Et=Math.abs(x.segments[Ee].timestamp-S);Et<Me&&(Me=Et,xe=Ee)}be=Me}if(be>8)return;const Be=`${x.id}_${xe}`;L.has(Be)||L.set(Be,[]),L.get(Be).push(I)}}}),L},[O,se,de]),Le=!ae||ie,Re=()=>{switch(he){case 2:return e.jsx(oa,{mediaBaseUrl:b,displayData:se,activeId:A||n,wsKey:t,tagsMap:Ce,startTime:de});case 1:return e.jsx(sa,{displayData:se,transcriptLength:Z.length,searchTerm:U,setSearchTerm:ee,isLive:Y,isOnline:oe,pendingJumpId:N,setPendingJumpId:W,tagsMap:Ce,startTime:de});default:return e.jsx(ia,{displayData:se,pendingJumpId:N,setPendingJumpId:W,tagsMap:Ce,startTime:de})}};return e.jsx(e.Fragment,{children:m!=="online"&&m!=="reconnecting"||K?e.jsx(Qi,{serverStatus:K?"loading":m}):e.jsx(e.Fragment,{children:J&&!K?e.jsx(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",height:P},children:me?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"h6",color:"error",gutterBottom:!0,children:"Error Loading Transcript"}),e.jsx(o,{variant:"body1",children:me})]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{color:"primary",sx:{fontSize:60,mb:2}}),e.jsxs(o,{variant:"h5",component:"h2",sx:{mb:1},children:["No Data Available for ",t.charAt(0).toUpperCase()+t.slice(1)]}),e.jsx(o,{color:"text.secondary",children:"No transcript data was found."}),e.jsx(o,{color:"text.secondary",children:"This usually happens when the server data is reset."})]})}):e.jsxs(u,{sx:{display:"flex",flexDirection:"column",height:P,bgcolor:"background.default"},children:[e.jsxs(u,{sx:{flexShrink:0},children:[m==="reconnecting"&&e.jsx(la,{}),e.jsx(Yi,{wsKey:t,jumpToLine:we}),Le&&e.jsx(ca,{}),!ae&&c&&v&&e.jsx(Xi,{startTime:de}),je&&e.jsx(u,{sx:{p:2,pb:0},children:e.jsx(o,{color:"warning.main",sx:{fontWeight:"bold"},children:"The current transcript is out of sync. Refresh to fix it."})}),j.length>0&&e.jsxs(u,{sx:{display:"flex",width:"100%",alignItems:"center",justifyContent:"center",mb:1,mt:2},children:[e.jsx(re,{label:"Search Transcript",variant:"outlined",size:"small","data-testid":"search-transcript",id:"search-transcript",value:U,onChange:L=>ee(L.target.value),slotProps:{input:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(Kt,{})})}},sx:{width:ie?"100%":"50%"}}),U&&e.jsx($e,{onClick:()=>ee(""),"aria-label":"clear search","data-testid":"clear-search",children:e.jsx(ns,{})}),e.jsx(fe,{title:f?"Exit Clip Mode":"Enter Clip Mode",children:e.jsx(ne,{"data-testid":"clip-mode-button",onClick:a,color:f?"secondary":"primary",variant:f?"contained":"text",startIcon:e.jsx(Qt,{}),size:"small",sx:{ml:1,whiteSpace:"nowrap"},children:ie?"Clip":"Clip Mode"})}),e.jsx(fe,{title:ae?"Show Header":"Minimize Header",children:e.jsx($e,{onClick:()=>z(!ae),children:ae?e.jsx(Fe,{}):e.jsx(ss,{})})})]}),f&&e.jsx(u,{sx:{width:"100%",display:"flex",justifyContent:"center",mb:1,px:2,textAlign:"center"},children:e.jsx(o,{variant:"body2",color:"secondary",sx:{fontWeight:"bold"},children:R===-1?"Click on the line to set it as one end of the clip":"Click on another line to set it as the start/end of the clip. Or click on the reset button to reset the clip selection"})}),!ae&&e.jsx(u,{sx:{display:"flex",justifyContent:"center",width:"100%",mb:1},children:e.jsxs(Ct,{value:he,onChange:ke,sx:{minHeight:"48px"},indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,children:[e.jsx(Ze,{"data-testid":"transcript-tab-pagination",label:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",lineHeight:1.2},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:"bold",textTransform:"none"},children:"New Lines at Top"}),e.jsx(o,{variant:"caption",sx:{fontSize:"0.7rem",opacity:.8,textTransform:"none"},children:"Original Pagination"})]}),sx:{minHeight:"48px",py:1,minWidth:"auto",px:2}}),e.jsx(Ze,{"data-testid":"transcript-tab-virtual",label:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",lineHeight:1.2},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:"bold",textTransform:"none"},children:"New Lines at Bottom"}),e.jsx(o,{variant:"caption",sx:{fontSize:"0.7rem",opacity:.8,textTransform:"none"},children:"Pauses when scrolling"})]}),sx:{minHeight:"48px",py:1,minWidth:"auto",px:2}}),p==="video"&&e.jsx(Ze,{"data-testid":"transcript-tab-visual",label:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",lineHeight:1.2},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:"bold",textTransform:"none"},children:"Visual Frames"}),e.jsx(o,{variant:"caption",sx:{fontSize:"0.7rem",opacity:.8,textTransform:"none"},children:"Grid of Line Images"})]}),sx:{minHeight:"48px",py:1,minWidth:"auto",px:2}})]})}),e.jsx("hr",{})]}),me?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",height:P},children:[e.jsx(o,{variant:"h6",color:"error",gutterBottom:!0,children:"Error Loading Transcript"}),e.jsx(o,{variant:"body1",children:me})]}):Re()]})})})}const pa=(t,n)=>t===void 0||typeof t!="string"||n.length===0?0:t.toLowerCase().split(n.toLowerCase()).length-1;function ha(){const t=l(f=>f.activeTitle),n=l(f=>f.transcript),s=l(f=>f.startTime),c=l(f=>f.timeFormat),[i,p]=h.useState(""),b=Se("(max-width:768px)"),j=f=>c==="relative"?De(f,s):c==="local"?Qe(f):c==="UTC"?St(f):`${f}`,m=h.useCallback(()=>{const f=[],a=[];if(i==="")return{data:f,timestamps:a};let R=0;return n?.forEach((D,A)=>{const M=D?.timestamp??0;D?.segments?.forEach(y=>{R+=pa(y?.text,i)}),(f.length===0||f.at(-1)!==R||A===n.length-1)&&(f.push(R),a.push(M))}),{data:f,timestamps:a}},[n,i]),{data:E,timestamps:v}=m(),$=E.length>0?E.at(-1):0,k=v.length>0?De(v.at(-1),s):0,O=E.length>1?De(v.at(1),s):0;return e.jsxs(e.Fragment,{children:[b?e.jsx(o,{color:"primary",variant:"h5",component:"h5",sx:{mb:2,wordBreak:"break-word",pl:b?6:0},children:t}):e.jsx(o,{color:"primary",variant:"h4",component:"h4",sx:{mb:2,wordBreak:"break-word",pl:b?6:0},children:t}),e.jsxs(bt,{direction:"column",width:"auto",maxWidth:1200,minWidth:300,children:[e.jsx(re,{id:"word-input",label:"Text to search",variant:"standard",fullWidth:!0,onChange:f=>{p(f.target.value)}}),E.length>0&&i.length>2?e.jsxs(bt,{direction:{xs:"column"},spacing:{xs:0,md:4},sx:{width:"100%"},children:[e.jsx(u,{sx:{flexGrow:1},children:e.jsx(lt,{xAxis:[{data:v,scaleType:"time",dataKey:"time",valueFormatter:f=>j(f)}],series:[{data:E,label:"Count",curve:"linear"}],height:b?300:500,skipAnimation:!0})}),e.jsxs(bt,{direction:"column",children:[e.jsxs(o,{sx:{display:"flex"},children:["Max count: ",$]}),e.jsxs(o,{sx:{display:"flex"},children:["Stream duration: ",k]}),e.jsxs(o,{sx:{display:"flex"},children:["Time to first usage: ",O]})]})]}):e.jsxs("div",{children:[e.jsx(o,{color:"error",children:"Text should be at least 3 characters long"}),e.jsx(lt,{xAxis:[{data:[],scaleType:"time",dataKey:"time",valueFormatter:f=>Qe(f)}],series:[{data:[],label:"Count"}],height:400})]})]})]})}function ma(){const[t,n]=h.useState(""),[s,c]=h.useState(""),i=j=>{const m=j.target.value;n(m),c(wt(m))},p=()=>{n(""),c("")},b=()=>{s&&navigator.clipboard.writeText(s)};return e.jsxs(u,{sx:{p:4,display:"flex",flexDirection:"column",gap:3,maxWidth:800,mx:"auto"},children:[e.jsx(o,{variant:"h4",component:"h1",gutterBottom:!0,children:"Censor Test"}),e.jsx(re,{label:"Input Text",multiline:!0,rows:4,variant:"outlined",fullWidth:!0,value:t,onChange:i,placeholder:"Type something here to see it censored..."}),e.jsxs(u,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Output:"}),e.jsx(Te,{variant:"outlined",sx:{p:2,minHeight:100,bgcolor:"background.default"},children:e.jsx(o,{style:{whiteSpace:"pre-wrap"},children:s||"Censored output will appear here..."})})]}),e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(ne,{variant:"outlined",color:"error",onClick:p,children:"Clear"}),e.jsx(ne,{variant:"contained",onClick:b,disabled:!s,children:"Copy Output"})]})]})}function ua(){const t=Tt(),n=Se("(max-width:768px)"),s=l(i=>i.devMode),c=i=>{t(`/${i}/`)};return e.jsxs(is,{maxWidth:"lg",sx:{minHeight:"80vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",py:4},children:[e.jsxs(u,{sx:{mb:6,textAlign:"center"},children:[e.jsxs(o,{variant:n?"h3":"h2",component:"h1",fontWeight:"bold",sx:{background:i=>`linear-gradient(45deg, ${i.palette.primary.main}, ${i.palette.primary.alt})`,backgroundClip:"text",textFillColor:"transparent",mb:2},children:["Live Transcripts ",s?"(Dev Mode)":""]}),e.jsx(o,{variant:"h6",color:"text.secondary",sx:{maxWidth:600,mx:"auto"},children:"Select a streamer to view real-time transcripts."})]}),e.jsx(_e,{container:!0,spacing:4,justifyContent:"center",alignItems:"stretch",children:$t(120).map((i,p)=>e.jsx(_e,{item:!0,xs:12,sm:6,md:4,sx:{display:"flex"},children:e.jsx(as,{in:!0,timeout:500+p*200,children:e.jsx(rs,{sx:{width:"100%",borderRadius:4,transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out","&:hover":{transform:"translateY(-8px)",boxShadow:b=>b.shadows[10]},background:b=>b.palette.background.paper},elevation:4,children:e.jsxs(os,{onClick:()=>c(i.value),"data-testid":i.testId,sx:{height:"100%",p:3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(u,{sx:{mb:3},children:i.icon}),e.jsx(ls,{sx:{p:0,textAlign:"center"},children:e.jsx(o,{gutterBottom:!0,variant:"h4",component:"div",fontWeight:"medium",children:i.name})})]})})})},i.value))}),e.jsxs(u,{sx:{mt:8,textAlign:"center"},children:[e.jsx(o,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Looking for past streams?"}),e.jsx(ne,{href:"/archived-transcript",variant:"outlined",size:"large","data-testid":"archive-btn",sx:{mt:1,borderRadius:2,px:4,textTransform:"none",fontSize:"1.1rem"},children:"Browse Archived Transcripts"})]})]})}const ga=t=>{const n=l(m=>m.formattedRows),s=l(m=>m.setFormattedRows),c=l(m=>m.controls),i=l(m=>m.setControls),p=l(m=>m.inputTags),b=l(m=>m.setInputTags),j=h.useRef(null);h.useEffect(()=>{if(!t||j.current===t)return;const m=localStorage.getItem(`tagFormatter_input_${t}`),E=localStorage.getItem(`tagFormatter_rows_${t}`),v=localStorage.getItem(`tagFormatter_controls_${t}`);b(m||"");let $=[];if(E)try{$=JSON.parse(E)}catch{}s($);let k={};if(v)try{k=JSON.parse(v)}catch{}i(k),j.current=t},[t,s,i,b]),h.useEffect(()=>{!t||j.current!==t||localStorage.setItem(`tagFormatter_input_${t}`,p)},[p,t]),h.useEffect(()=>{!t||j.current!==t||localStorage.setItem(`tagFormatter_rows_${t}`,JSON.stringify(n))},[n,t]),h.useEffect(()=>{!t||j.current!==t||localStorage.setItem(`tagFormatter_controls_${t}`,JSON.stringify(c))},[c,t])};function xa(){const t=qt(),n=l(b=>b.theme);let c=Se("(prefers-color-scheme: dark)")?Dt:Lt;n==="light"?c=Lt:n==="dark"&&(c=Dt);const i=t.pathname.split("/")[1],p=Ss().find(b=>b===i);return ga(p),e.jsxs(cs,{theme:c,children:[e.jsx(ds,{}),e.jsx(qi,{}),window.maintenance?e.jsxs(jt,{children:[e.jsx(Ge,{path:"*",element:e.jsx(Ji,{})}),e.jsx(Ge,{path:"tagFixer/",element:e.jsx(zt,{wsKey:void 0})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pi,{wsKey:p}),e.jsx(Ui,{wsKey:p}),e.jsx(Hi,{wsKey:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(ks,{wsKey:p}),e.jsxs(jt,{children:[e.jsx(Ge,{path:`${p}/*`,element:e.jsx(da,{wsKey:p})}),e.jsx(Ge,{path:`${p}/graph/`,element:e.jsx(ha,{})}),e.jsx(Ge,{path:`${p}/tagFixer/`,element:e.jsx(zt,{wsKey:p})})]})]}):e.jsxs(jt,{children:[e.jsx(Ge,{path:"/censor",element:e.jsx(ma,{})}),e.jsx(Ge,{path:"*",element:e.jsx(ua,{})})]})})]})]})}ps.createRoot(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(hs,{basename:"live-transcript",children:e.jsx(xa,{})})}));
